2025-05-10 23:03:26,757 | INFO | üìÑ Starting processing file: 2025 - 01 - 01- Night Audit Packet.pdf
2025-05-10 23:03:26,759 | INFO | üìÑ Starting processing file: 2025 - 01 - 02- Night Audit Packet.pdf
2025-05-10 23:03:26,760 | INFO | üìÑ Starting processing file: 2025 - 01 - 03- Night Audit Packet.pdf
2025-05-10 23:03:26,828 | INFO | üìÑ Starting processing file: 2025 - 01 - 04- Night Audit Packet.pdf
2025-05-10 23:03:26,829 | INFO | üìÑ Starting processing file: 2025 - 01 - 05- Night Audit Packet.pdf
2025-05-10 23:03:26,848 | INFO | üìÑ Starting processing file: 2025 - 01 - 06- Night Audit Packet.pdf
2025-05-10 23:03:26,875 | INFO | üìÑ Starting processing file: 2025 - 01 - 07- Night Audit Packet.pdf
2025-05-10 23:03:26,932 | INFO | üìÑ Starting processing file: 2025 - 01 - 08- Night Audit Packet.pdf
2025-05-10 23:03:50,037 | ERROR | ‚ùå A/R Aging extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-02' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 525.0, 'days_30': 325.0, 'days_60': 225.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72773.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '169773-FL453-2025-01-02' for key 'ar_aging.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-02' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 525.0, 'days_30': 325.0, 'days_60': 225.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72773.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 49, 996274)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:03:50,548 | ERROR | ‚ùå A/R Aging extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-03' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 550.0, 'days_30': 325.0, 'days_60': 225.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72798.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '169773-FL453-2025-01-03' for key 'ar_aging.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-03' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 550.0, 'days_30': 325.0, 'days_60': 225.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72798.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 50, 508519)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:03:51,093 | ERROR | ‚ùå A/R Aging extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-07' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 500.0, 'days_30': 400.0, 'days_60': 250.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72848.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '169773-FL453-2025-01-07' for key 'ar_aging.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-07' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 500.0, 'days_30': 400.0, 'days_60': 250.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72848.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 64983)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:03:51,466 | ERROR | ‚ùå A/R Aging extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-06' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 500.0, 'days_30': 400.0, 'days_60': 250.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72848.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '169773-FL453-2025-01-06' for key 'ar_aging.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-06' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 500.0, 'days_30': 400.0, 'days_60': 250.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72848.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 441040)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:03:51,739 | ERROR | ‚ùå A/R Aging extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-04' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 525.0, 'days_30': 325.0, 'days_60': 250.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72798.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '169773-FL453-2025-01-04' for key 'ar_aging.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-04' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 525.0, 'days_30': 325.0, 'days_60': 250.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72798.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 709433)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:03:51,767 | ERROR | ‚ùå A/R Aging extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-05' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 550.0, 'days_30': 325.0, 'days_60': 250.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72823.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '169773-FL453-2025-01-05' for key 'ar_aging.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-05' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 550.0, 'days_30': 325.0, 'days_60': 250.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72823.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 752970)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:03:51,909 | ERROR | ‚ùå A/R Aging extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-08' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 575.0, 'days_30': 375.0, 'days_60': 275.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72923.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '169773-FL453-2025-01-08' for key 'ar_aging.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-08' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 575.0, 'days_30': 375.0, 'days_60': 275.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72923.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 51, 889355)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:03:52,141 | ERROR | ‚ùå A/R Aging extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-09' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 525.0, 'days_30': 475.0, 'days_60': 275.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72973.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '169773-FL453-2025-01-09' for key 'ar_aging.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '169773-FL453-2025-01-09' for key 'ar_aging.PRIMARY'
[SQL: INSERT INTO ar_aging (account, guest_name, current, days_30, days_60, days_90, days_120, credits, balance, limit_amount, property_code, user, report_date, source_file, load_timestamp) VALUES (%(account)s, %(guest_name)s, %(current)s, %(days_30)s, %(days_60)s, %(days_90)s, %(days_120)s, %(credits)s, %(balance)s, %(limit_amount)s, %(property_code)s, %(user)s, %(report_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'account': '169773', 'guest_name': 'CHOICE PRIVILEGES A/R ACCT# 106', 'current': 525.0, 'days_30': 475.0, 'days_60': 275.66, 'days_90': 0.0, 'days_120': 71698.11, 'credits': 0.0, 'balance': 72973.77, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '447128', 'guest_name': 'CORPORATE LODGING CONSULTANTS', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 130722.73, 'credits': -6.26, 'balance': 130722.73, 'limit_amount': 10000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '1262583', 'guest_name': 'NWFL SYMPHONY ORCHESTRA', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 75.47, 'credits': 0.0, 'balance': 75.47, 'limit_amount': 5000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '1459824', 'guest_name': 'H20 PRUF, LLC', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 639.18, 'credits': 0.0, 'balance': 639.18, 'limit_amount': 1500.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '1526533', 'guest_name': 'DELTA AIRLINES INC.', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 908.93, 'credits': 0.0, 'balance': 908.93, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '1530547', 'guest_name': 'Unpaid Folios', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 9485.14, 'credits': 0.0, 'balance': 9485.14, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '1557431', 'guest_name': 'HALPERNS SEAFOOD', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 201.4, 'credits': 0.0, 'balance': 201.4, 'limit_amount': 2000.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '1607500', 'guest_name': 'Thunderbird', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 301.0, 'credits': 0.0, 'balance': 301.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}  ... displaying 10 of 32 total bound parameter sets ...  {'account': '3448722', 'guest_name': 'Niceville Housing Authority', 'current': 0.0, 'days_30': 0.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 516.0, 'credits': 0.0, 'balance': 516.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)}, {'account': '3601939', 'guest_name': 'Stuckman Tree Cutting Company', 'current': 0.0, 'days_30': 960.0, 'days_60': 0.0, 'days_90': 0.0, 'days_120': 0.0, 'credits': 0.0, 'balance': 960.0, 'limit_amount': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'report_date': datetime.date(2025, 1, 9), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 3, 52, 118015)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:00,129 | ERROR | ‚ùå Transaction Closeout extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Cash (CA)-FL453-2025-01-01' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Cash (CA)', 'opening_balance': 0.0, 'todays_total': -68.95, 'todays_adjustments': 0.0, 'todays_net': -68.95, 'ptd_totals': -68.95, 'ytd_totals': -68.95, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Total For CASH:', 'opening_balance': 0.0, 'todays_total': -68.95, 'todays_adjustments': 0.0, 'todays_net': -68.95, 'ptd_totals': -68.95, 'ytd_totals': -68.95, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Visa Payment (VI)', 'opening_balance': 0.0, 'todays_total': -142.49, 'todays_adjustments': 0.0, 'todays_net': -142.49, 'ptd_totals': -142.49, 'ytd_totals': -142.49, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Total For CREDIT CARDS:', 'opening_balance': 0.0, 'todays_total': -142.49, 'todays_adjustments': 0.0, 'todays_net': -142.49, 'ptd_totals': -142.49, 'ytd_totals': -142.49, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Room Charge (RM)', 'opening_balance': 0.0, 'todays_total': 1579.74, 'todays_adjustments': 0.0, 'todays_net': 1579.74, 'ptd_totals': 1579.74, 'ytd_totals': 1579.74, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Total For ROOM REVENUE:', 'opening_balance': 0.0, 'todays_total': 1579.74, 'todays_adjustments': 0.0, 'todays_net': 1579.74, 'ptd_totals': 1579.74, 'ytd_totals': 1579.74, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'State Tax (T1)', 'opening_balance': 0.0, 'todays_total': 104.84, 'todays_adjustments': 0.0, 'todays_net': 104.84, 'ptd_totals': 104.84, 'ytd_totals': 104.84, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Tourism Tax (T5)', 'opening_balance': 0.0, 'todays_total': 74.89, 'todays_adjustments': 0.0, 'todays_net': 74.89, 'ptd_totals': 74.89, 'ytd_totals': 74.89, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Total For TAX:', 'opening_balance': 0.0, 'todays_total': 179.73, 'todays_adjustments': 0.0, 'todays_net': 179.73, 'ptd_totals': 179.73, 'ytd_totals': 179.73, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry 'Cash (CA)-FL453-2025-01-01' for key 'transaction_closeout.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Cash (CA)-FL453-2025-01-01' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Cash (CA)', 'opening_balance': 0.0, 'todays_total': -68.95, 'todays_adjustments': 0.0, 'todays_net': -68.95, 'ptd_totals': -68.95, 'ytd_totals': -68.95, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Total For CASH:', 'opening_balance': 0.0, 'todays_total': -68.95, 'todays_adjustments': 0.0, 'todays_net': -68.95, 'ptd_totals': -68.95, 'ytd_totals': -68.95, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Visa Payment (VI)', 'opening_balance': 0.0, 'todays_total': -142.49, 'todays_adjustments': 0.0, 'todays_net': -142.49, 'ptd_totals': -142.49, 'ytd_totals': -142.49, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Total For CREDIT CARDS:', 'opening_balance': 0.0, 'todays_total': -142.49, 'todays_adjustments': 0.0, 'todays_net': -142.49, 'ptd_totals': -142.49, 'ytd_totals': -142.49, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Room Charge (RM)', 'opening_balance': 0.0, 'todays_total': 1579.74, 'todays_adjustments': 0.0, 'todays_net': 1579.74, 'ptd_totals': 1579.74, 'ytd_totals': 1579.74, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Total For ROOM REVENUE:', 'opening_balance': 0.0, 'todays_total': 1579.74, 'todays_adjustments': 0.0, 'todays_net': 1579.74, 'ptd_totals': 1579.74, 'ytd_totals': 1579.74, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'State Tax (T1)', 'opening_balance': 0.0, 'todays_total': 104.84, 'todays_adjustments': 0.0, 'todays_net': 104.84, 'ptd_totals': 104.84, 'ytd_totals': 104.84, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Tourism Tax (T5)', 'opening_balance': 0.0, 'todays_total': 74.89, 'todays_adjustments': 0.0, 'todays_net': 74.89, 'ptd_totals': 74.89, 'ytd_totals': 74.89, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)}, {'description': 'Total For TAX:', 'opening_balance': 0.0, 'todays_total': 179.73, 'todays_adjustments': 0.0, 'todays_net': 179.73, 'ptd_totals': 179.73, 'ytd_totals': 179.73, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 108281)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:00,171 | INFO | ‚úÖ Processed In-House List
2025-05-10 23:04:00,646 | ERROR | ‚ùå Transaction Closeout extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-02' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': 0.0, 'todays_total': -25.0, 'todays_adjustments': 0.0, 'todays_net': -25.0, 'ptd_totals': -25.0, 'ytd_totals': -25.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 0.0, 'todays_total': 25.0, 'todays_adjustments': 0.0, 'todays_net': 25.0, 'ptd_totals': 25.0, 'ytd_totals': 25.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'Cash (CA)', 'opening_balance': -68.95, 'todays_total': -68.95, 'todays_adjustments': 0.0, 'todays_net': -68.95, 'ptd_totals': -137.9, 'ytd_totals': -137.9, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'Total For CASH:', 'opening_balance': -68.95, 'todays_total': -68.95, 'todays_adjustments': 0.0, 'todays_net': -68.95, 'ptd_totals': -137.9, 'ytd_totals': -137.9, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'American Express (AX)', 'opening_balance': 0.0, 'todays_total': -784.18, 'todays_adjustments': 0.0, 'todays_net': -784.18, 'ptd_totals': -784.18, 'ytd_totals': -784.18, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'Master Card (MC)', 'opening_balance': 0.0, 'todays_total': -131.18, 'todays_adjustments': 0.0, 'todays_net': -131.18, 'ptd_totals': -131.18, 'ytd_totals': -131.18, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'Visa Payment (VI)', 'opening_balance': -142.49, 'todays_total': -525.0, 'todays_adjustments': 0.0, 'todays_net': -525.0, 'ptd_totals': -667.49, 'ytd_totals': -667.49, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 74.89, 'todays_total': 80.59, 'todays_adjustments': 0.0, 'todays_net': 80.59, 'ptd_totals': 155.48, 'ytd_totals': 155.48, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'Total For TAX:', 'opening_balance': 179.73, 'todays_total': 193.39, 'todays_adjustments': 0.0, 'todays_net': 193.39, 'ptd_totals': 373.12, 'ytd_totals': 373.12, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-02' for key 'transaction_closeout.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-02' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': 0.0, 'todays_total': -25.0, 'todays_adjustments': 0.0, 'todays_net': -25.0, 'ptd_totals': -25.0, 'ytd_totals': -25.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 0.0, 'todays_total': 25.0, 'todays_adjustments': 0.0, 'todays_net': 25.0, 'ptd_totals': 25.0, 'ytd_totals': 25.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'Cash (CA)', 'opening_balance': -68.95, 'todays_total': -68.95, 'todays_adjustments': 0.0, 'todays_net': -68.95, 'ptd_totals': -137.9, 'ytd_totals': -137.9, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'Total For CASH:', 'opening_balance': -68.95, 'todays_total': -68.95, 'todays_adjustments': 0.0, 'todays_net': -68.95, 'ptd_totals': -137.9, 'ytd_totals': -137.9, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'American Express (AX)', 'opening_balance': 0.0, 'todays_total': -784.18, 'todays_adjustments': 0.0, 'todays_net': -784.18, 'ptd_totals': -784.18, 'ytd_totals': -784.18, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'Master Card (MC)', 'opening_balance': 0.0, 'todays_total': -131.18, 'todays_adjustments': 0.0, 'todays_net': -131.18, 'ptd_totals': -131.18, 'ytd_totals': -131.18, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'Visa Payment (VI)', 'opening_balance': -142.49, 'todays_total': -525.0, 'todays_adjustments': 0.0, 'todays_net': -525.0, 'ptd_totals': -667.49, 'ytd_totals': -667.49, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 74.89, 'todays_total': 80.59, 'todays_adjustments': 0.0, 'todays_net': 80.59, 'ptd_totals': 155.48, 'ytd_totals': 155.48, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)}, {'description': 'Total For TAX:', 'opening_balance': 179.73, 'todays_total': 193.39, 'todays_adjustments': 0.0, 'todays_net': 193.39, 'ptd_totals': 373.12, 'ytd_totals': 373.12, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 0, 611744)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:00,687 | INFO | ‚úÖ Processed In-House List
2025-05-10 23:04:01,208 | ERROR | ‚ùå Transaction Closeout extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-06' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': -511.8, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -511.8, 'ytd_totals': -511.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 511.8, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 511.8, 'ytd_totals': 511.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'Cash (CA)', 'opening_balance': -560.29, 'todays_total': -214.11, 'todays_adjustments': 0.0, 'todays_net': -214.11, 'ptd_totals': -774.4, 'ytd_totals': -774.4, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'Total For CASH:', 'opening_balance': -560.29, 'todays_total': -214.11, 'todays_adjustments': 0.0, 'todays_net': -214.11, 'ptd_totals': -774.4, 'ytd_totals': -774.4, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'American Express (AX)', 'opening_balance': -3270.58, 'todays_total': 0.0, 'todays_adjustments': 703.54, 'todays_net': 703.54, 'ptd_totals': -2567.04, 'ytd_totals': -2567.04, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'Master Card (MC)', 'opening_balance': -823.15, 'todays_total': -645.65, 'todays_adjustments': 0.0, 'todays_net': -645.65, 'ptd_totals': -1468.8, 'ytd_totals': -1468.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'Visa Payment (VI)', 'opening_balance': -1269.91, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -1269.91, 'ytd_totals': -1269.91, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 376.61, 'todays_total': 80.38, 'todays_adjustments': -2.91, 'todays_net': 77.47, 'ptd_totals': 454.08, 'ytd_totals': 454.08, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'Total For TAX:', 'opening_balance': 903.82, 'todays_total': 192.91, 'todays_adjustments': -6.98, 'todays_net': 185.93, 'ptd_totals': 1089.75, 'ytd_totals': 1089.75, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-06' for key 'transaction_closeout.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-06' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': -511.8, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -511.8, 'ytd_totals': -511.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 511.8, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 511.8, 'ytd_totals': 511.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'Cash (CA)', 'opening_balance': -560.29, 'todays_total': -214.11, 'todays_adjustments': 0.0, 'todays_net': -214.11, 'ptd_totals': -774.4, 'ytd_totals': -774.4, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'Total For CASH:', 'opening_balance': -560.29, 'todays_total': -214.11, 'todays_adjustments': 0.0, 'todays_net': -214.11, 'ptd_totals': -774.4, 'ytd_totals': -774.4, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'American Express (AX)', 'opening_balance': -3270.58, 'todays_total': 0.0, 'todays_adjustments': 703.54, 'todays_net': 703.54, 'ptd_totals': -2567.04, 'ytd_totals': -2567.04, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'Master Card (MC)', 'opening_balance': -823.15, 'todays_total': -645.65, 'todays_adjustments': 0.0, 'todays_net': -645.65, 'ptd_totals': -1468.8, 'ytd_totals': -1468.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'Visa Payment (VI)', 'opening_balance': -1269.91, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -1269.91, 'ytd_totals': -1269.91, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 376.61, 'todays_total': 80.38, 'todays_adjustments': -2.91, 'todays_net': 77.47, 'ptd_totals': 454.08, 'ytd_totals': 454.08, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)}, {'description': 'Total For TAX:', 'opening_balance': 903.82, 'todays_total': 192.91, 'todays_adjustments': -6.98, 'todays_net': 185.93, 'ptd_totals': 1089.75, 'ytd_totals': 1089.75, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 153610)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:01,240 | INFO | ‚úÖ Processed In-House List
2025-05-10 23:04:01,580 | ERROR | ‚ùå Transaction Closeout extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-05' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': -486.8, 'todays_total': -25.0, 'todays_adjustments': 0.0, 'todays_net': -25.0, 'ptd_totals': -511.8, 'ytd_totals': -511.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 486.8, 'todays_total': 25.0, 'todays_adjustments': 0.0, 'todays_net': 25.0, 'ptd_totals': 511.8, 'ytd_totals': 511.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'Cash (CA)', 'opening_balance': -346.18, 'todays_total': -214.11, 'todays_adjustments': 0.0, 'todays_net': -214.11, 'ptd_totals': -560.29, 'ytd_totals': -560.29, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'Total For CASH:', 'opening_balance': -346.18, 'todays_total': -214.11, 'todays_adjustments': 0.0, 'todays_net': -214.11, 'ptd_totals': -560.29, 'ytd_totals': -560.29, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'American Express (AX)', 'opening_balance': -1321.78, 'todays_total': -1948.8, 'todays_adjustments': 0.0, 'todays_net': -1948.8, 'ptd_totals': -3270.58, 'ytd_totals': -3270.58, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'Master Card (MC)', 'opening_balance': -823.15, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -823.15, 'ytd_totals': -823.15, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'Visa Payment (VI)', 'opening_balance': -1269.91, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -1269.91, 'ytd_totals': -1269.91, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 299.92, 'todays_total': 76.69, 'todays_adjustments': 0.0, 'todays_net': 76.69, 'ptd_totals': 376.61, 'ytd_totals': 376.61, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'Total For TAX:', 'opening_balance': 719.78, 'todays_total': 184.04, 'todays_adjustments': 0.0, 'todays_net': 184.04, 'ptd_totals': 903.82, 'ytd_totals': 903.82, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-05' for key 'transaction_closeout.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-05' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': -486.8, 'todays_total': -25.0, 'todays_adjustments': 0.0, 'todays_net': -25.0, 'ptd_totals': -511.8, 'ytd_totals': -511.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 486.8, 'todays_total': 25.0, 'todays_adjustments': 0.0, 'todays_net': 25.0, 'ptd_totals': 511.8, 'ytd_totals': 511.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'Cash (CA)', 'opening_balance': -346.18, 'todays_total': -214.11, 'todays_adjustments': 0.0, 'todays_net': -214.11, 'ptd_totals': -560.29, 'ytd_totals': -560.29, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'Total For CASH:', 'opening_balance': -346.18, 'todays_total': -214.11, 'todays_adjustments': 0.0, 'todays_net': -214.11, 'ptd_totals': -560.29, 'ytd_totals': -560.29, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'American Express (AX)', 'opening_balance': -1321.78, 'todays_total': -1948.8, 'todays_adjustments': 0.0, 'todays_net': -1948.8, 'ptd_totals': -3270.58, 'ytd_totals': -3270.58, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'Master Card (MC)', 'opening_balance': -823.15, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -823.15, 'ytd_totals': -823.15, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'Visa Payment (VI)', 'opening_balance': -1269.91, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -1269.91, 'ytd_totals': -1269.91, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 299.92, 'todays_total': 76.69, 'todays_adjustments': 0.0, 'todays_net': 76.69, 'ptd_totals': 376.61, 'ytd_totals': 376.61, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)}, {'description': 'Total For TAX:', 'opening_balance': 719.78, 'todays_total': 184.04, 'todays_adjustments': 0.0, 'todays_net': 184.04, 'ptd_totals': 903.82, 'ytd_totals': 903.82, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 542811)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:01,623 | INFO | ‚úÖ Processed In-House List
2025-05-10 23:04:01,827 | ERROR | ‚ùå Transaction Closeout extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-03' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': -25.0, 'todays_total': -72.8, 'todays_adjustments': 0.0, 'todays_net': -72.8, 'ptd_totals': -97.8, 'ytd_totals': -97.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 25.0, 'todays_total': 72.8, 'todays_adjustments': 0.0, 'todays_net': 72.8, 'ptd_totals': 97.8, 'ytd_totals': 97.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'Cash (CA)', 'opening_balance': -137.9, 'todays_total': -65.5, 'todays_adjustments': 0.0, 'todays_net': -65.5, 'ptd_totals': -203.4, 'ytd_totals': -203.4, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'Total For CASH:', 'opening_balance': -137.9, 'todays_total': -65.5, 'todays_adjustments': 0.0, 'todays_net': -65.5, 'ptd_totals': -203.4, 'ytd_totals': -203.4, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'American Express (AX)', 'opening_balance': -784.18, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -784.18, 'ytd_totals': -784.18, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'Master Card (MC)', 'opening_balance': -131.18, 'todays_total': -426.41, 'todays_adjustments': 0.0, 'todays_net': -426.41, 'ptd_totals': -557.59, 'ytd_totals': -557.59, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'Visa Payment (VI)', 'opening_balance': -667.49, 'todays_total': -227.36, 'todays_adjustments': 0.0, 'todays_net': -227.36, 'ptd_totals': -894.85, 'ytd_totals': -894.85, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 155.48, 'todays_total': 81.57, 'todays_adjustments': 0.0, 'todays_net': 81.57, 'ptd_totals': 237.05, 'ytd_totals': 237.05, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'Total For TAX:', 'opening_balance': 373.12, 'todays_total': 195.77, 'todays_adjustments': 0.0, 'todays_net': 195.77, 'ptd_totals': 568.89, 'ytd_totals': 568.89, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-03' for key 'transaction_closeout.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-03' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': -25.0, 'todays_total': -72.8, 'todays_adjustments': 0.0, 'todays_net': -72.8, 'ptd_totals': -97.8, 'ytd_totals': -97.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 25.0, 'todays_total': 72.8, 'todays_adjustments': 0.0, 'todays_net': 72.8, 'ptd_totals': 97.8, 'ytd_totals': 97.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'Cash (CA)', 'opening_balance': -137.9, 'todays_total': -65.5, 'todays_adjustments': 0.0, 'todays_net': -65.5, 'ptd_totals': -203.4, 'ytd_totals': -203.4, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'Total For CASH:', 'opening_balance': -137.9, 'todays_total': -65.5, 'todays_adjustments': 0.0, 'todays_net': -65.5, 'ptd_totals': -203.4, 'ytd_totals': -203.4, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'American Express (AX)', 'opening_balance': -784.18, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -784.18, 'ytd_totals': -784.18, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'Master Card (MC)', 'opening_balance': -131.18, 'todays_total': -426.41, 'todays_adjustments': 0.0, 'todays_net': -426.41, 'ptd_totals': -557.59, 'ytd_totals': -557.59, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'Visa Payment (VI)', 'opening_balance': -667.49, 'todays_total': -227.36, 'todays_adjustments': 0.0, 'todays_net': -227.36, 'ptd_totals': -894.85, 'ytd_totals': -894.85, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 155.48, 'todays_total': 81.57, 'todays_adjustments': 0.0, 'todays_net': 81.57, 'ptd_totals': 237.05, 'ytd_totals': 237.05, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)}, {'description': 'Total For TAX:', 'opening_balance': 373.12, 'todays_total': 195.77, 'todays_adjustments': 0.0, 'todays_net': 195.77, 'ptd_totals': 568.89, 'ytd_totals': 568.89, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 803097)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:01,854 | ERROR | ‚ùå Transaction Closeout extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-04' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': -97.8, 'todays_total': -389.0, 'todays_adjustments': 0.0, 'todays_net': -389.0, 'ptd_totals': -486.8, 'ytd_totals': -486.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 97.8, 'todays_total': 389.0, 'todays_adjustments': 0.0, 'todays_net': 389.0, 'ptd_totals': 486.8, 'ytd_totals': 486.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'Cash (CA)', 'opening_balance': -203.4, 'todays_total': -142.78, 'todays_adjustments': 0.0, 'todays_net': -142.78, 'ptd_totals': -346.18, 'ytd_totals': -346.18, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'Total For CASH:', 'opening_balance': -203.4, 'todays_total': -142.78, 'todays_adjustments': 0.0, 'todays_net': -142.78, 'ptd_totals': -346.18, 'ytd_totals': -346.18, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'American Express (AX)', 'opening_balance': -784.18, 'todays_total': -537.6, 'todays_adjustments': 0.0, 'todays_net': -537.6, 'ptd_totals': -1321.78, 'ytd_totals': -1321.78, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'Master Card (MC)', 'opening_balance': -557.59, 'todays_total': -265.56, 'todays_adjustments': 0.0, 'todays_net': -265.56, 'ptd_totals': -823.15, 'ytd_totals': -823.15, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'Visa Payment (VI)', 'opening_balance': -894.85, 'todays_total': -375.06, 'todays_adjustments': 0.0, 'todays_net': -375.06, 'ptd_totals': -1269.91, 'ytd_totals': -1269.91, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 237.05, 'todays_total': 69.37, 'todays_adjustments': -6.5, 'todays_net': 62.87, 'ptd_totals': 299.92, 'ytd_totals': 299.92, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'Total For TAX:', 'opening_balance': 568.89, 'todays_total': 166.49, 'todays_adjustments': -15.6, 'todays_net': 150.89, 'ptd_totals': 719.78, 'ytd_totals': 719.78, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-04' for key 'transaction_closeout.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-04' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': -97.8, 'todays_total': -389.0, 'todays_adjustments': 0.0, 'todays_net': -389.0, 'ptd_totals': -486.8, 'ytd_totals': -486.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 97.8, 'todays_total': 389.0, 'todays_adjustments': 0.0, 'todays_net': 389.0, 'ptd_totals': 486.8, 'ytd_totals': 486.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'Cash (CA)', 'opening_balance': -203.4, 'todays_total': -142.78, 'todays_adjustments': 0.0, 'todays_net': -142.78, 'ptd_totals': -346.18, 'ytd_totals': -346.18, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'Total For CASH:', 'opening_balance': -203.4, 'todays_total': -142.78, 'todays_adjustments': 0.0, 'todays_net': -142.78, 'ptd_totals': -346.18, 'ytd_totals': -346.18, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'American Express (AX)', 'opening_balance': -784.18, 'todays_total': -537.6, 'todays_adjustments': 0.0, 'todays_net': -537.6, 'ptd_totals': -1321.78, 'ytd_totals': -1321.78, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'Master Card (MC)', 'opening_balance': -557.59, 'todays_total': -265.56, 'todays_adjustments': 0.0, 'todays_net': -265.56, 'ptd_totals': -823.15, 'ytd_totals': -823.15, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'Visa Payment (VI)', 'opening_balance': -894.85, 'todays_total': -375.06, 'todays_adjustments': 0.0, 'todays_net': -375.06, 'ptd_totals': -1269.91, 'ytd_totals': -1269.91, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 237.05, 'todays_total': 69.37, 'todays_adjustments': -6.5, 'todays_net': 62.87, 'ptd_totals': 299.92, 'ytd_totals': 299.92, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)}, {'description': 'Total For TAX:', 'opening_balance': 568.89, 'todays_total': 166.49, 'todays_adjustments': -15.6, 'todays_net': 150.89, 'ptd_totals': 719.78, 'ytd_totals': 719.78, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 819208)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:01,879 | INFO | ‚úÖ Processed In-House List
2025-05-10 23:04:01,905 | INFO | ‚úÖ Processed In-House List
2025-05-10 23:04:02,007 | ERROR | ‚ùå Transaction Closeout extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-07' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': -511.8, 'todays_total': -75.0, 'todays_adjustments': 0.0, 'todays_net': -75.0, 'ptd_totals': -586.8, 'ytd_totals': -586.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 511.8, 'todays_total': 75.0, 'todays_adjustments': 0.0, 'todays_net': 75.0, 'ptd_totals': 586.8, 'ytd_totals': 586.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'Cash (CA)', 'opening_balance': -774.4, 'todays_total': -156.55, 'todays_adjustments': 0.0, 'todays_net': -156.55, 'ptd_totals': -930.95, 'ytd_totals': -930.95, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'Total For CASH:', 'opening_balance': -774.4, 'todays_total': -156.55, 'todays_adjustments': 0.0, 'todays_net': -156.55, 'ptd_totals': -930.95, 'ytd_totals': -930.95, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'American Express (AX)', 'opening_balance': -2567.04, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -2567.04, 'ytd_totals': -2567.04, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'Master Card (MC)', 'opening_balance': -1468.8, 'todays_total': -389.38, 'todays_adjustments': 0.0, 'todays_net': -389.38, 'ptd_totals': -1858.18, 'ytd_totals': -1858.18, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'Visa Payment (VI)', 'opening_balance': -1269.91, 'todays_total': -721.17, 'todays_adjustments': 0.0, 'todays_net': -721.17, 'ptd_totals': -1991.08, 'ytd_totals': -1991.08, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 454.08, 'todays_total': 83.74, 'todays_adjustments': 0.0, 'todays_net': 83.74, 'ptd_totals': 537.82, 'ytd_totals': 537.82, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'Total For TAX:', 'opening_balance': 1089.75, 'todays_total': 200.97, 'todays_adjustments': 0.0, 'todays_net': 200.97, 'ptd_totals': 1290.72, 'ytd_totals': 1290.72, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-07' for key 'transaction_closeout.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-07' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': -511.8, 'todays_total': -75.0, 'todays_adjustments': 0.0, 'todays_net': -75.0, 'ptd_totals': -586.8, 'ytd_totals': -586.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 511.8, 'todays_total': 75.0, 'todays_adjustments': 0.0, 'todays_net': 75.0, 'ptd_totals': 586.8, 'ytd_totals': 586.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'Cash (CA)', 'opening_balance': -774.4, 'todays_total': -156.55, 'todays_adjustments': 0.0, 'todays_net': -156.55, 'ptd_totals': -930.95, 'ytd_totals': -930.95, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'Total For CASH:', 'opening_balance': -774.4, 'todays_total': -156.55, 'todays_adjustments': 0.0, 'todays_net': -156.55, 'ptd_totals': -930.95, 'ytd_totals': -930.95, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'American Express (AX)', 'opening_balance': -2567.04, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -2567.04, 'ytd_totals': -2567.04, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'Master Card (MC)', 'opening_balance': -1468.8, 'todays_total': -389.38, 'todays_adjustments': 0.0, 'todays_net': -389.38, 'ptd_totals': -1858.18, 'ytd_totals': -1858.18, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'Visa Payment (VI)', 'opening_balance': -1269.91, 'todays_total': -721.17, 'todays_adjustments': 0.0, 'todays_net': -721.17, 'ptd_totals': -1991.08, 'ytd_totals': -1991.08, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 454.08, 'todays_total': 83.74, 'todays_adjustments': 0.0, 'todays_net': 83.74, 'ptd_totals': 537.82, 'ytd_totals': 537.82, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)}, {'description': 'Total For TAX:', 'opening_balance': 1089.75, 'todays_total': 200.97, 'todays_adjustments': 0.0, 'todays_net': 200.97, 'ptd_totals': 1290.72, 'ytd_totals': 1290.72, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 1, 970020)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:02,048 | INFO | ‚úÖ Processed In-House List
2025-05-10 23:04:02,249 | ERROR | ‚ùå Transaction Closeout extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-08' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': -586.8, 'todays_total': -50.0, 'todays_adjustments': 0.0, 'todays_net': -50.0, 'ptd_totals': -636.8, 'ytd_totals': -636.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 586.8, 'todays_total': 50.0, 'todays_adjustments': 0.0, 'todays_net': 50.0, 'ptd_totals': 636.8, 'ytd_totals': 636.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'Cash (CA)', 'opening_balance': -930.95, 'todays_total': -69.91, 'todays_adjustments': 0.0, 'todays_net': -69.91, 'ptd_totals': -1000.86, 'ytd_totals': -1000.86, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'Total For CASH:', 'opening_balance': -930.95, 'todays_total': -69.91, 'todays_adjustments': 0.0, 'todays_net': -69.91, 'ptd_totals': -1000.86, 'ytd_totals': -1000.86, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'American Express (AX)', 'opening_balance': -2567.04, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -2567.04, 'ytd_totals': -2567.04, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'Master Card (MC)', 'opening_balance': -1858.18, 'todays_total': -343.94, 'todays_adjustments': 0.0, 'todays_net': -343.94, 'ptd_totals': -2202.12, 'ytd_totals': -2202.12, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'Visa Payment (VI)', 'opening_balance': -1991.08, 'todays_total': -473.92, 'todays_adjustments': 0.0, 'todays_net': -473.92, 'ptd_totals': -2465.0, 'ytd_totals': -2465.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 537.82, 'todays_total': 86.47, 'todays_adjustments': 0.0, 'todays_net': 86.47, 'ptd_totals': 624.29, 'ytd_totals': 624.29, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'Total For TAX:', 'opening_balance': 1290.72, 'todays_total': 207.53, 'todays_adjustments': 0.0, 'todays_net': 207.53, 'ptd_totals': 1498.25, 'ytd_totals': 1498.25, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-08' for key 'transaction_closeout.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'Direct Bill (DB)-FL453-2025-01-08' for key 'transaction_closeout.PRIMARY'
[SQL: INSERT INTO transaction_closeout (description, opening_balance, todays_total, todays_adjustments, todays_net, ptd_totals, ytd_totals, property_code, user, business_date, source_file, load_timestamp) VALUES (%(description)s, %(opening_balance)s, %(todays_total)s, %(todays_adjustments)s, %(todays_net)s, %(ptd_totals)s, %(ytd_totals)s, %(property_code)s, %(user)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'description': 'Direct Bill (DB)', 'opening_balance': -586.8, 'todays_total': -50.0, 'todays_adjustments': 0.0, 'todays_net': -50.0, 'ptd_totals': -636.8, 'ytd_totals': -636.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'Direct Billing Receivable (DR)', 'opening_balance': 586.8, 'todays_total': 50.0, 'todays_adjustments': 0.0, 'todays_net': 50.0, 'ptd_totals': 636.8, 'ytd_totals': 636.8, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'RECEIVABLE:', 'opening_balance': 0.0, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': 0.0, 'ytd_totals': 0.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'Cash (CA)', 'opening_balance': -930.95, 'todays_total': -69.91, 'todays_adjustments': 0.0, 'todays_net': -69.91, 'ptd_totals': -1000.86, 'ytd_totals': -1000.86, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'Total For CASH:', 'opening_balance': -930.95, 'todays_total': -69.91, 'todays_adjustments': 0.0, 'todays_net': -69.91, 'ptd_totals': -1000.86, 'ytd_totals': -1000.86, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'American Express (AX)', 'opening_balance': -2567.04, 'todays_total': 0.0, 'todays_adjustments': 0.0, 'todays_net': 0.0, 'ptd_totals': -2567.04, 'ytd_totals': -2567.04, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'Master Card (MC)', 'opening_balance': -1858.18, 'todays_total': -343.94, 'todays_adjustments': 0.0, 'todays_net': -343.94, 'ptd_totals': -2202.12, 'ytd_totals': -2202.12, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'Visa Payment (VI)', 'opening_balance': -1991.08, 'todays_total': -473.92, 'todays_adjustments': 0.0, 'todays_net': -473.92, 'ptd_totals': -2465.0, 'ytd_totals': -2465.0, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}  ... displaying 10 of 14 total bound parameter sets ...  {'description': 'Tourism Tax (T5)', 'opening_balance': 537.82, 'todays_total': 86.47, 'todays_adjustments': 0.0, 'todays_net': 86.47, 'ptd_totals': 624.29, 'ytd_totals': 624.29, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)}, {'description': 'Total For TAX:', 'opening_balance': 1290.72, 'todays_total': 207.53, 'todays_adjustments': 0.0, 'todays_net': 207.53, 'ptd_totals': 1498.25, 'ytd_totals': 1498.25, 'property_code': 'FL453', 'user': 'reaga.fl453', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 2, 221552)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:02,272 | INFO | ‚úÖ Processed In-House List
2025-05-10 23:04:10,236 | ERROR | ‚ùå room_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-01-2025 - 01 - 01- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '111', 'last_year_ptd': '111', 'current_ytd': '111', 'last_ytd': '111', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Out Of Order', 'today': '40', 'current_ptd': '40', 'last_year_ptd': '63', 'current_ytd': '40', 'last_ytd': '63', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Rooms Available to Sell', 'today': '71', 'current_ptd': '71', 'last_year_ptd': '48', 'current_ytd': '71', 'last_ytd': '48', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Stay Over Rooms', 'today': '26', 'current_ptd': '26', 'last_year_ptd': '29', 'current_ytd': '26', 'last_ytd': '29', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Total Revenue Rooms', 'today': '26', 'current_ptd': '26', 'last_year_ptd': '29', 'current_ytd': '26', 'last_ytd': '29', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '5', 'last_year_ptd': '0', 'current_ytd': '5', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '5', 'last_year_ptd': '0', 'current_ytd': '5', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Total Occupied Rooms', 'today': '31', 'current_ptd': '31', 'last_year_ptd': '29', 'current_ytd': '31', 'last_ytd': '29', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-01-2025 - 01 - 01- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-01-2025 - 01 - 01- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '111', 'last_year_ptd': '111', 'current_ytd': '111', 'last_ytd': '111', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Out Of Order', 'today': '40', 'current_ptd': '40', 'last_year_ptd': '63', 'current_ytd': '40', 'last_ytd': '63', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Rooms Available to Sell', 'today': '71', 'current_ptd': '71', 'last_year_ptd': '48', 'current_ytd': '71', 'last_ytd': '48', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Stay Over Rooms', 'today': '26', 'current_ptd': '26', 'last_year_ptd': '29', 'current_ytd': '26', 'last_ytd': '29', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Total Revenue Rooms', 'today': '26', 'current_ptd': '26', 'last_year_ptd': '29', 'current_ytd': '26', 'last_ytd': '29', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '5', 'last_year_ptd': '0', 'current_ytd': '5', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '5', 'last_year_ptd': '0', 'current_ytd': '5', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)}, {'metric': 'Total Occupied Rooms', 'today': '31', 'current_ptd': '31', 'last_year_ptd': '29', 'current_ytd': '31', 'last_ytd': '29', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 212873)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:10,752 | ERROR | ‚ùå room_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-02-2025 - 01 - 02- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '222', 'last_year_ptd': '222', 'current_ytd': '222', 'last_ytd': '222', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Out Of Order', 'today': '45', 'current_ptd': '85', 'last_year_ptd': '100', 'current_ytd': '85', 'last_ytd': '100', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Rooms Available to Sell', 'today': '66', 'current_ptd': '137', 'last_year_ptd': '122', 'current_ytd': '137', 'last_ytd': '122', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Stay Over Rooms', 'today': '26', 'current_ptd': '52', 'last_year_ptd': '62', 'current_ytd': '52', 'last_ytd': '62', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Total Revenue Rooms', 'today': '26', 'current_ptd': '52', 'last_year_ptd': '62', 'current_ytd': '52', 'last_ytd': '62', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '10', 'last_year_ptd': '0', 'current_ytd': '10', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '10', 'last_year_ptd': '0', 'current_ytd': '10', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Total Occupied Rooms', 'today': '31', 'current_ptd': '62', 'last_year_ptd': '62', 'current_ytd': '62', 'last_ytd': '62', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-02-2025 - 01 - 02- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-02-2025 - 01 - 02- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '222', 'last_year_ptd': '222', 'current_ytd': '222', 'last_ytd': '222', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Out Of Order', 'today': '45', 'current_ptd': '85', 'last_year_ptd': '100', 'current_ytd': '85', 'last_ytd': '100', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Rooms Available to Sell', 'today': '66', 'current_ptd': '137', 'last_year_ptd': '122', 'current_ytd': '137', 'last_ytd': '122', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Stay Over Rooms', 'today': '26', 'current_ptd': '52', 'last_year_ptd': '62', 'current_ytd': '52', 'last_ytd': '62', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Total Revenue Rooms', 'today': '26', 'current_ptd': '52', 'last_year_ptd': '62', 'current_ytd': '52', 'last_ytd': '62', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '10', 'last_year_ptd': '0', 'current_ytd': '10', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '10', 'last_year_ptd': '0', 'current_ytd': '10', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)}, {'metric': 'Total Occupied Rooms', 'today': '31', 'current_ptd': '62', 'last_year_ptd': '62', 'current_ytd': '62', 'last_ytd': '62', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 10, 729297)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:11,299 | ERROR | ‚ùå room_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-06-2025 - 01 - 06- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '666', 'last_year_ptd': '666', 'current_ytd': '666', 'last_ytd': '666', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Out Of Order', 'today': '47', 'current_ptd': '271', 'last_year_ptd': '252', 'current_ytd': '271', 'last_ytd': '252', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Rooms Available to Sell', 'today': '64', 'current_ptd': '395', 'last_year_ptd': '414', 'current_ytd': '395', 'last_ytd': '414', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Stay Over Rooms', 'today': '27', 'current_ptd': '156', 'last_year_ptd': '211', 'current_ytd': '156', 'last_ytd': '211', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Total Revenue Rooms', 'today': '27', 'current_ptd': '156', 'last_year_ptd': '211', 'current_ytd': '156', 'last_ytd': '211', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '30', 'last_year_ptd': '0', 'current_ytd': '30', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '30', 'last_year_ptd': '0', 'current_ytd': '30', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Total Occupied Rooms', 'today': '32', 'current_ptd': '186', 'last_year_ptd': '211', 'current_ytd': '186', 'last_ytd': '211', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-06-2025 - 01 - 06- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-06-2025 - 01 - 06- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '666', 'last_year_ptd': '666', 'current_ytd': '666', 'last_ytd': '666', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Out Of Order', 'today': '47', 'current_ptd': '271', 'last_year_ptd': '252', 'current_ytd': '271', 'last_ytd': '252', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Rooms Available to Sell', 'today': '64', 'current_ptd': '395', 'last_year_ptd': '414', 'current_ytd': '395', 'last_ytd': '414', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Stay Over Rooms', 'today': '27', 'current_ptd': '156', 'last_year_ptd': '211', 'current_ytd': '156', 'last_ytd': '211', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Total Revenue Rooms', 'today': '27', 'current_ptd': '156', 'last_year_ptd': '211', 'current_ytd': '156', 'last_ytd': '211', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '30', 'last_year_ptd': '0', 'current_ytd': '30', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '30', 'last_year_ptd': '0', 'current_ytd': '30', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)}, {'metric': 'Total Occupied Rooms', 'today': '32', 'current_ptd': '186', 'last_year_ptd': '211', 'current_ytd': '186', 'last_ytd': '211', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 274184)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:11,692 | ERROR | ‚ùå room_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-05-2025 - 01 - 05- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '555', 'last_year_ptd': '555', 'current_ytd': '555', 'last_ytd': '555', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Out Of Order', 'today': '47', 'current_ptd': '224', 'last_year_ptd': '214', 'current_ytd': '224', 'last_ytd': '214', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Rooms Available to Sell', 'today': '64', 'current_ptd': '331', 'last_year_ptd': '341', 'current_ytd': '331', 'last_ytd': '341', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Stay Over Rooms', 'today': '26', 'current_ptd': '129', 'last_year_ptd': '177', 'current_ytd': '129', 'last_ytd': '177', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Total Revenue Rooms', 'today': '26', 'current_ptd': '129', 'last_year_ptd': '177', 'current_ytd': '129', 'last_ytd': '177', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '25', 'last_year_ptd': '0', 'current_ytd': '25', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '25', 'last_year_ptd': '0', 'current_ytd': '25', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Total Occupied Rooms', 'today': '31', 'current_ptd': '154', 'last_year_ptd': '177', 'current_ytd': '154', 'last_ytd': '177', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-05-2025 - 01 - 05- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-05-2025 - 01 - 05- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '555', 'last_year_ptd': '555', 'current_ytd': '555', 'last_ytd': '555', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Out Of Order', 'today': '47', 'current_ptd': '224', 'last_year_ptd': '214', 'current_ytd': '224', 'last_ytd': '214', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Rooms Available to Sell', 'today': '64', 'current_ptd': '331', 'last_year_ptd': '341', 'current_ytd': '331', 'last_ytd': '341', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Stay Over Rooms', 'today': '26', 'current_ptd': '129', 'last_year_ptd': '177', 'current_ytd': '129', 'last_ytd': '177', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Total Revenue Rooms', 'today': '26', 'current_ptd': '129', 'last_year_ptd': '177', 'current_ytd': '129', 'last_ytd': '177', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '25', 'last_year_ptd': '0', 'current_ytd': '25', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '25', 'last_year_ptd': '0', 'current_ytd': '25', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)}, {'metric': 'Total Occupied Rooms', 'today': '31', 'current_ptd': '154', 'last_year_ptd': '177', 'current_ytd': '154', 'last_ytd': '177', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 673960)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:11,952 | ERROR | ‚ùå room_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-03-2025 - 01 - 03- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '333', 'last_year_ptd': '333', 'current_ytd': '333', 'last_ytd': '333', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Out Of Order', 'today': '45', 'current_ptd': '130', 'last_year_ptd': '138', 'current_ytd': '130', 'last_ytd': '138', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Rooms Available to Sell', 'today': '66', 'current_ptd': '203', 'last_year_ptd': '195', 'current_ytd': '203', 'last_ytd': '195', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Stay Over Rooms', 'today': '26', 'current_ptd': '78', 'last_year_ptd': '99', 'current_ytd': '78', 'last_ytd': '99', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Total Revenue Rooms', 'today': '26', 'current_ptd': '78', 'last_year_ptd': '99', 'current_ytd': '78', 'last_ytd': '99', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '15', 'last_year_ptd': '0', 'current_ytd': '15', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '15', 'last_year_ptd': '0', 'current_ytd': '15', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Total Occupied Rooms', 'today': '31', 'current_ptd': '93', 'last_year_ptd': '99', 'current_ytd': '93', 'last_ytd': '99', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-03-2025 - 01 - 03- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-03-2025 - 01 - 03- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '333', 'last_year_ptd': '333', 'current_ytd': '333', 'last_ytd': '333', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Out Of Order', 'today': '45', 'current_ptd': '130', 'last_year_ptd': '138', 'current_ytd': '130', 'last_ytd': '138', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Rooms Available to Sell', 'today': '66', 'current_ptd': '203', 'last_year_ptd': '195', 'current_ytd': '203', 'last_ytd': '195', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Stay Over Rooms', 'today': '26', 'current_ptd': '78', 'last_year_ptd': '99', 'current_ytd': '78', 'last_ytd': '99', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Total Revenue Rooms', 'today': '26', 'current_ptd': '78', 'last_year_ptd': '99', 'current_ytd': '78', 'last_ytd': '99', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '15', 'last_year_ptd': '0', 'current_ytd': '15', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '15', 'last_year_ptd': '0', 'current_ytd': '15', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)}, {'metric': 'Total Occupied Rooms', 'today': '31', 'current_ptd': '93', 'last_year_ptd': '99', 'current_ytd': '93', 'last_ytd': '99', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 929195)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:11,972 | ERROR | ‚ùå room_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-04-2025 - 01 - 04- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '444', 'last_year_ptd': '444', 'current_ytd': '444', 'last_ytd': '444', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Out Of Order', 'today': '47', 'current_ptd': '177', 'last_year_ptd': '176', 'current_ytd': '177', 'last_ytd': '176', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Rooms Available to Sell', 'today': '64', 'current_ptd': '267', 'last_year_ptd': '268', 'current_ytd': '267', 'last_ytd': '268', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Stay Over Rooms', 'today': '25', 'current_ptd': '103', 'last_year_ptd': '137', 'current_ytd': '103', 'last_ytd': '137', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Total Revenue Rooms', 'today': '25', 'current_ptd': '103', 'last_year_ptd': '137', 'current_ytd': '103', 'last_ytd': '137', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '20', 'last_year_ptd': '0', 'current_ytd': '20', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '20', 'last_year_ptd': '0', 'current_ytd': '20', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Total Occupied Rooms', 'today': '30', 'current_ptd': '123', 'last_year_ptd': '137', 'current_ytd': '123', 'last_ytd': '137', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-04-2025 - 01 - 04- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-04-2025 - 01 - 04- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '444', 'last_year_ptd': '444', 'current_ytd': '444', 'last_ytd': '444', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Out Of Order', 'today': '47', 'current_ptd': '177', 'last_year_ptd': '176', 'current_ytd': '177', 'last_ytd': '176', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Rooms Available to Sell', 'today': '64', 'current_ptd': '267', 'last_year_ptd': '268', 'current_ytd': '267', 'last_ytd': '268', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Stay Over Rooms', 'today': '25', 'current_ptd': '103', 'last_year_ptd': '137', 'current_ytd': '103', 'last_ytd': '137', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Total Revenue Rooms', 'today': '25', 'current_ptd': '103', 'last_year_ptd': '137', 'current_ytd': '103', 'last_ytd': '137', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '20', 'last_year_ptd': '0', 'current_ytd': '20', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '20', 'last_year_ptd': '0', 'current_ytd': '20', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)}, {'metric': 'Total Occupied Rooms', 'today': '30', 'current_ptd': '123', 'last_year_ptd': '137', 'current_ytd': '123', 'last_ytd': '137', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 11, 956520)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:12,107 | ERROR | ‚ùå room_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-07-2025 - 01 - 07- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '777', 'last_year_ptd': '777', 'current_ytd': '777', 'last_ytd': '777', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Out Of Order', 'today': '47', 'current_ptd': '318', 'last_year_ptd': '290', 'current_ytd': '318', 'last_ytd': '290', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Rooms Available to Sell', 'today': '64', 'current_ptd': '459', 'last_year_ptd': '487', 'current_ytd': '459', 'last_ytd': '487', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Stay Over Rooms', 'today': '27', 'current_ptd': '183', 'last_year_ptd': '240', 'current_ytd': '183', 'last_ytd': '240', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Total Revenue Rooms', 'today': '27', 'current_ptd': '183', 'last_year_ptd': '240', 'current_ytd': '183', 'last_ytd': '240', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '35', 'last_year_ptd': '0', 'current_ytd': '35', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '35', 'last_year_ptd': '0', 'current_ytd': '35', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Total Occupied Rooms', 'today': '32', 'current_ptd': '218', 'last_year_ptd': '240', 'current_ytd': '218', 'last_ytd': '240', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-07-2025 - 01 - 07- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-07-2025 - 01 - 07- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '777', 'last_year_ptd': '777', 'current_ytd': '777', 'last_ytd': '777', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Out Of Order', 'today': '47', 'current_ptd': '318', 'last_year_ptd': '290', 'current_ytd': '318', 'last_ytd': '290', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Rooms Available to Sell', 'today': '64', 'current_ptd': '459', 'last_year_ptd': '487', 'current_ytd': '459', 'last_ytd': '487', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Stay Over Rooms', 'today': '27', 'current_ptd': '183', 'last_year_ptd': '240', 'current_ytd': '183', 'last_ytd': '240', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Total Revenue Rooms', 'today': '27', 'current_ptd': '183', 'last_year_ptd': '240', 'current_ytd': '183', 'last_ytd': '240', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '35', 'last_year_ptd': '0', 'current_ytd': '35', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '35', 'last_year_ptd': '0', 'current_ytd': '35', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)}, {'metric': 'Total Occupied Rooms', 'today': '32', 'current_ptd': '218', 'last_year_ptd': '240', 'current_ytd': '218', 'last_ytd': '240', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 91286)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:12,342 | ERROR | ‚ùå room_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-08-2025 - 01 - 08- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '888', 'last_year_ptd': '888', 'current_ytd': '888', 'last_ytd': '888', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Out Of Order', 'today': '48', 'current_ptd': '366', 'last_year_ptd': '328', 'current_ytd': '366', 'last_ytd': '328', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Rooms Available to Sell', 'today': '63', 'current_ptd': '522', 'last_year_ptd': '560', 'current_ytd': '522', 'last_ytd': '560', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Stay Over Rooms', 'today': '27', 'current_ptd': '210', 'last_year_ptd': '274', 'current_ytd': '210', 'last_ytd': '274', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Total Revenue Rooms', 'today': '27', 'current_ptd': '210', 'last_year_ptd': '274', 'current_ytd': '210', 'last_ytd': '274', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '40', 'last_year_ptd': '0', 'current_ytd': '40', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '40', 'last_year_ptd': '0', 'current_ytd': '40', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Total Occupied Rooms', 'today': '32', 'current_ptd': '250', 'last_year_ptd': '274', 'current_ytd': '250', 'last_ytd': '274', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-08-2025 - 01 - 08- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-08-2025 - 01 - 08- Night Audit Packet.pdf-Total Rooms' for key 'room_statistics.PRIMARY'
[SQL: INSERT INTO room_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Total Rooms', 'today': '111', 'current_ptd': '888', 'last_year_ptd': '888', 'current_ytd': '888', 'last_ytd': '888', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Out Of Order', 'today': '48', 'current_ptd': '366', 'last_year_ptd': '328', 'current_ytd': '366', 'last_ytd': '328', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Rooms Available to Sell', 'today': '63', 'current_ptd': '522', 'last_year_ptd': '560', 'current_ytd': '522', 'last_ytd': '560', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Day Use Rooms', 'today': '0', 'current_ptd': '0', 'last_year_ptd': '0', 'current_ytd': '0', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Stay Over Rooms', 'today': '27', 'current_ptd': '210', 'last_year_ptd': '274', 'current_ytd': '210', 'last_ytd': '274', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Total Revenue Rooms', 'today': '27', 'current_ptd': '210', 'last_year_ptd': '274', 'current_ytd': '210', 'last_ytd': '274', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Comp Rooms', 'today': '5', 'current_ptd': '40', 'last_year_ptd': '0', 'current_ytd': '40', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Total Non-Revenue Rooms', 'today': '5', 'current_ptd': '40', 'last_year_ptd': '0', 'current_ytd': '40', 'last_ytd': '0', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)}, {'metric': 'Total Occupied Rooms', 'today': '32', 'current_ptd': '250', 'last_year_ptd': '274', 'current_ytd': '250', 'last_ytd': '274', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 12, 304331)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:20,328 | ERROR | ‚ùå performance_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-01-2025 - 01 - 01- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '43.66 %', 'current_ptd': '43.66 %', 'last_year_ptd': '60.42 %', 'current_ytd': '43.66 %', 'last_ytd': '60.42 %', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'Occ% of Total Rooms', 'today': '27.93 %', 'current_ptd': '27.93 %', 'last_year_ptd': '26.13 %', 'current_ytd': '27.93 %', 'last_ytd': '26.13 %', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '23.42 %', 'current_ptd': '23.42 %', 'last_year_ptd': '26.13 %', 'current_ytd': '23.42 %', 'last_ytd': '26.13 %', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'ADR Stay Over Rooms', 'today': '60.76', 'current_ptd': '60.76', 'last_year_ptd': '64.02', 'current_ytd': '60.76', 'last_ytd': '64.02', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '60.76', 'current_ptd': '60.76', 'last_year_ptd': '64.02', 'current_ytd': '60.76', 'last_ytd': '64.02', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '60.76', 'current_ptd': '60.76', 'last_year_ptd': '64.02', 'current_ytd': '60.76', 'last_ytd': '64.02', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '50.96', 'current_ptd': '50.96', 'last_year_ptd': '64.02', 'current_ytd': '50.96', 'last_ytd': '64.02', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'RevPar', 'today': '22.25', 'current_ptd': '22.25', 'last_year_ptd': '38.68', 'current_ytd': '22.25', 'last_ytd': '38.68', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'STR (STAR) RevPar', 'today': '14.23', 'current_ptd': '14.23', 'last_year_ptd': '16.72', 'current_ytd': '14.23', 'last_ytd': '16.72', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-01-2025 - 01 - 01- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-01-2025 - 01 - 01- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '43.66 %', 'current_ptd': '43.66 %', 'last_year_ptd': '60.42 %', 'current_ytd': '43.66 %', 'last_ytd': '60.42 %', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'Occ% of Total Rooms', 'today': '27.93 %', 'current_ptd': '27.93 %', 'last_year_ptd': '26.13 %', 'current_ytd': '27.93 %', 'last_ytd': '26.13 %', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '23.42 %', 'current_ptd': '23.42 %', 'last_year_ptd': '26.13 %', 'current_ytd': '23.42 %', 'last_ytd': '26.13 %', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'ADR Stay Over Rooms', 'today': '60.76', 'current_ptd': '60.76', 'last_year_ptd': '64.02', 'current_ytd': '60.76', 'last_ytd': '64.02', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '60.76', 'current_ptd': '60.76', 'last_year_ptd': '64.02', 'current_ytd': '60.76', 'last_ytd': '64.02', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '60.76', 'current_ptd': '60.76', 'last_year_ptd': '64.02', 'current_ytd': '60.76', 'last_ytd': '64.02', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '50.96', 'current_ptd': '50.96', 'last_year_ptd': '64.02', 'current_ytd': '50.96', 'last_ytd': '64.02', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'RevPar', 'today': '22.25', 'current_ptd': '22.25', 'last_year_ptd': '38.68', 'current_ytd': '22.25', 'last_ytd': '38.68', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)}, {'metric': 'STR (STAR) RevPar', 'today': '14.23', 'current_ptd': '14.23', 'last_year_ptd': '16.72', 'current_ytd': '14.23', 'last_ytd': '16.72', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 296862)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:20,841 | ERROR | ‚ùå performance_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-02-2025 - 01 - 02- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '46.97 %', 'current_ptd': '45.26 %', 'last_year_ptd': '50.82 %', 'current_ytd': '45.26 %', 'last_ytd': '50.82 %', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'Occ% of Total Rooms', 'today': '27.93 %', 'current_ptd': '27.93 %', 'last_year_ptd': '27.93 %', 'current_ytd': '27.93 %', 'last_ytd': '27.93 %', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '23.42 %', 'current_ptd': '23.42 %', 'last_year_ptd': '27.93 %', 'current_ytd': '23.42 %', 'last_ytd': '27.93 %', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'ADR Stay Over Rooms', 'today': '61.98', 'current_ptd': '61.37', 'last_year_ptd': '64.24', 'current_ytd': '61.37', 'last_ytd': '64.24', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '61.98', 'current_ptd': '61.37', 'last_year_ptd': '64.24', 'current_ytd': '61.37', 'last_ytd': '64.24', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '61.98', 'current_ptd': '61.37', 'last_year_ptd': '64.24', 'current_ytd': '61.37', 'last_ytd': '64.24', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '51.98', 'current_ptd': '51.47', 'last_year_ptd': '64.24', 'current_ytd': '51.47', 'last_ytd': '64.24', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'RevPar', 'today': '24.42', 'current_ptd': '23.29', 'last_year_ptd': '32.65', 'current_ytd': '23.29', 'last_ytd': '32.65', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'STR (STAR) RevPar', 'today': '14.52', 'current_ptd': '14.37', 'last_year_ptd': '17.94', 'current_ytd': '14.37', 'last_ytd': '17.94', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-02-2025 - 01 - 02- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-02-2025 - 01 - 02- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '46.97 %', 'current_ptd': '45.26 %', 'last_year_ptd': '50.82 %', 'current_ytd': '45.26 %', 'last_ytd': '50.82 %', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'Occ% of Total Rooms', 'today': '27.93 %', 'current_ptd': '27.93 %', 'last_year_ptd': '27.93 %', 'current_ytd': '27.93 %', 'last_ytd': '27.93 %', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '23.42 %', 'current_ptd': '23.42 %', 'last_year_ptd': '27.93 %', 'current_ytd': '23.42 %', 'last_ytd': '27.93 %', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'ADR Stay Over Rooms', 'today': '61.98', 'current_ptd': '61.37', 'last_year_ptd': '64.24', 'current_ytd': '61.37', 'last_ytd': '64.24', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '61.98', 'current_ptd': '61.37', 'last_year_ptd': '64.24', 'current_ytd': '61.37', 'last_ytd': '64.24', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '61.98', 'current_ptd': '61.37', 'last_year_ptd': '64.24', 'current_ytd': '61.37', 'last_ytd': '64.24', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '51.98', 'current_ptd': '51.47', 'last_year_ptd': '64.24', 'current_ytd': '51.47', 'last_ytd': '64.24', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'RevPar', 'today': '24.42', 'current_ptd': '23.29', 'last_year_ptd': '32.65', 'current_ytd': '23.29', 'last_ytd': '32.65', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)}, {'metric': 'STR (STAR) RevPar', 'today': '14.52', 'current_ptd': '14.37', 'last_year_ptd': '17.94', 'current_ytd': '14.37', 'last_ytd': '17.94', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 20, 806733)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:21,390 | ERROR | ‚ùå performance_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-06-2025 - 01 - 06- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '50.00 %', 'current_ptd': '47.09 %', 'last_year_ptd': '50.97 %', 'current_ytd': '47.09 %', 'last_ytd': '50.97 %', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'Occ% of Total Rooms', 'today': '28.83 %', 'current_ptd': '27.93 %', 'last_year_ptd': '31.68 %', 'current_ytd': '27.93 %', 'last_ytd': '31.68 %', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '24.32 %', 'current_ptd': '23.42 %', 'last_year_ptd': '31.68 %', 'current_ytd': '23.42 %', 'last_ytd': '31.68 %', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'ADR Stay Over Rooms', 'today': '61.94', 'current_ptd': '61.08', 'last_year_ptd': '63.94', 'current_ytd': '61.08', 'last_ytd': '63.94', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '61.94', 'current_ptd': '61.08', 'last_year_ptd': '63.94', 'current_ytd': '61.08', 'last_ytd': '63.94', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '61.94', 'current_ptd': '61.08', 'last_year_ptd': '63.94', 'current_ytd': '61.08', 'last_ytd': '63.94', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '52.26', 'current_ptd': '51.23', 'last_year_ptd': '63.94', 'current_ytd': '51.23', 'last_ytd': '63.94', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'RevPar', 'today': '26.13', 'current_ptd': '24.12', 'last_year_ptd': '32.59', 'current_ytd': '24.12', 'last_ytd': '32.59', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'STR (STAR) RevPar', 'today': '15.07', 'current_ptd': '14.31', 'last_year_ptd': '20.26', 'current_ytd': '14.31', 'last_ytd': '20.26', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-06-2025 - 01 - 06- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-06-2025 - 01 - 06- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '50.00 %', 'current_ptd': '47.09 %', 'last_year_ptd': '50.97 %', 'current_ytd': '47.09 %', 'last_ytd': '50.97 %', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'Occ% of Total Rooms', 'today': '28.83 %', 'current_ptd': '27.93 %', 'last_year_ptd': '31.68 %', 'current_ytd': '27.93 %', 'last_ytd': '31.68 %', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '24.32 %', 'current_ptd': '23.42 %', 'last_year_ptd': '31.68 %', 'current_ytd': '23.42 %', 'last_ytd': '31.68 %', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'ADR Stay Over Rooms', 'today': '61.94', 'current_ptd': '61.08', 'last_year_ptd': '63.94', 'current_ytd': '61.08', 'last_ytd': '63.94', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '61.94', 'current_ptd': '61.08', 'last_year_ptd': '63.94', 'current_ytd': '61.08', 'last_ytd': '63.94', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '61.94', 'current_ptd': '61.08', 'last_year_ptd': '63.94', 'current_ytd': '61.08', 'last_ytd': '63.94', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '52.26', 'current_ptd': '51.23', 'last_year_ptd': '63.94', 'current_ytd': '51.23', 'last_ytd': '63.94', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'RevPar', 'today': '26.13', 'current_ptd': '24.12', 'last_year_ptd': '32.59', 'current_ytd': '24.12', 'last_ytd': '32.59', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)}, {'metric': 'STR (STAR) RevPar', 'today': '15.07', 'current_ptd': '14.31', 'last_year_ptd': '20.26', 'current_ytd': '14.31', 'last_ytd': '20.26', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 357197)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:21,771 | ERROR | ‚ùå performance_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-05-2025 - 01 - 05- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '48.44 %', 'current_ptd': '46.53 %', 'last_year_ptd': '51.91 %', 'current_ytd': '46.53 %', 'last_ytd': '51.91 %', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'Occ% of Total Rooms', 'today': '27.93 %', 'current_ptd': '27.75 %', 'last_year_ptd': '31.89 %', 'current_ytd': '27.75 %', 'last_ytd': '31.89 %', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '23.42 %', 'current_ptd': '23.24 %', 'last_year_ptd': '31.89 %', 'current_ytd': '23.24 %', 'last_ytd': '31.89 %', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'ADR Stay Over Rooms', 'today': '62.75', 'current_ptd': '60.90', 'last_year_ptd': '64.20', 'current_ytd': '60.90', 'last_ytd': '64.20', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '62.75', 'current_ptd': '60.90', 'last_year_ptd': '64.20', 'current_ytd': '60.90', 'last_ytd': '64.20', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '62.75', 'current_ptd': '60.90', 'last_year_ptd': '64.20', 'current_ytd': '60.90', 'last_ytd': '64.20', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '52.63', 'current_ptd': '51.01', 'last_year_ptd': '64.20', 'current_ytd': '51.01', 'last_ytd': '64.20', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'RevPar', 'today': '25.49', 'current_ptd': '23.73', 'last_year_ptd': '33.32', 'current_ytd': '23.73', 'last_ytd': '33.32', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'STR (STAR) RevPar', 'today': '14.70', 'current_ptd': '14.15', 'last_year_ptd': '20.48', 'current_ytd': '14.15', 'last_ytd': '20.48', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-05-2025 - 01 - 05- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-05-2025 - 01 - 05- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '48.44 %', 'current_ptd': '46.53 %', 'last_year_ptd': '51.91 %', 'current_ytd': '46.53 %', 'last_ytd': '51.91 %', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'Occ% of Total Rooms', 'today': '27.93 %', 'current_ptd': '27.75 %', 'last_year_ptd': '31.89 %', 'current_ytd': '27.75 %', 'last_ytd': '31.89 %', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '23.42 %', 'current_ptd': '23.24 %', 'last_year_ptd': '31.89 %', 'current_ytd': '23.24 %', 'last_ytd': '31.89 %', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'ADR Stay Over Rooms', 'today': '62.75', 'current_ptd': '60.90', 'last_year_ptd': '64.20', 'current_ytd': '60.90', 'last_ytd': '64.20', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '62.75', 'current_ptd': '60.90', 'last_year_ptd': '64.20', 'current_ytd': '60.90', 'last_ytd': '64.20', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '62.75', 'current_ptd': '60.90', 'last_year_ptd': '64.20', 'current_ytd': '60.90', 'last_ytd': '64.20', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '52.63', 'current_ptd': '51.01', 'last_year_ptd': '64.20', 'current_ytd': '51.01', 'last_ytd': '64.20', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'RevPar', 'today': '25.49', 'current_ptd': '23.73', 'last_year_ptd': '33.32', 'current_ytd': '23.73', 'last_ytd': '33.32', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)}, {'metric': 'STR (STAR) RevPar', 'today': '14.70', 'current_ptd': '14.15', 'last_year_ptd': '20.48', 'current_ytd': '14.15', 'last_ytd': '20.48', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 21, 742638)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:22,033 | ERROR | ‚ùå performance_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-03-2025 - 01 - 03- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '46.97 %', 'current_ptd': '45.81 %', 'last_year_ptd': '50.77 %', 'current_ytd': '45.81 %', 'last_ytd': '50.77 %', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'Occ% of Total Rooms', 'today': '27.93 %', 'current_ptd': '27.93 %', 'last_year_ptd': '29.73 %', 'current_ytd': '27.93 %', 'last_ytd': '29.73 %', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '23.42 %', 'current_ptd': '23.42 %', 'last_year_ptd': '29.73 %', 'current_ytd': '23.42 %', 'last_ytd': '29.73 %', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'ADR Stay Over Rooms', 'today': '63.71', 'current_ptd': '62.15', 'last_year_ptd': '64.22', 'current_ytd': '62.15', 'last_ytd': '64.22', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '63.71', 'current_ptd': '62.15', 'last_year_ptd': '64.22', 'current_ytd': '62.15', 'last_ytd': '64.22', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '63.71', 'current_ptd': '62.15', 'last_year_ptd': '64.22', 'current_ytd': '62.15', 'last_ytd': '64.22', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '53.44', 'current_ptd': '52.13', 'last_year_ptd': '64.22', 'current_ytd': '52.13', 'last_ytd': '64.22', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'RevPar', 'today': '25.10', 'current_ptd': '23.88', 'last_year_ptd': '32.60', 'current_ytd': '23.88', 'last_ytd': '32.60', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'STR (STAR) RevPar', 'today': '14.92', 'current_ptd': '14.56', 'last_year_ptd': '19.09', 'current_ytd': '14.56', 'last_ytd': '19.09', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-03-2025 - 01 - 03- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-03-2025 - 01 - 03- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '46.97 %', 'current_ptd': '45.81 %', 'last_year_ptd': '50.77 %', 'current_ytd': '45.81 %', 'last_ytd': '50.77 %', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'Occ% of Total Rooms', 'today': '27.93 %', 'current_ptd': '27.93 %', 'last_year_ptd': '29.73 %', 'current_ytd': '27.93 %', 'last_ytd': '29.73 %', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '23.42 %', 'current_ptd': '23.42 %', 'last_year_ptd': '29.73 %', 'current_ytd': '23.42 %', 'last_ytd': '29.73 %', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'ADR Stay Over Rooms', 'today': '63.71', 'current_ptd': '62.15', 'last_year_ptd': '64.22', 'current_ytd': '62.15', 'last_ytd': '64.22', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '63.71', 'current_ptd': '62.15', 'last_year_ptd': '64.22', 'current_ytd': '62.15', 'last_ytd': '64.22', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '63.71', 'current_ptd': '62.15', 'last_year_ptd': '64.22', 'current_ytd': '62.15', 'last_ytd': '64.22', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '53.44', 'current_ptd': '52.13', 'last_year_ptd': '64.22', 'current_ytd': '52.13', 'last_ytd': '64.22', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'RevPar', 'today': '25.10', 'current_ptd': '23.88', 'last_year_ptd': '32.60', 'current_ytd': '23.88', 'last_ytd': '32.60', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)}, {'metric': 'STR (STAR) RevPar', 'today': '14.92', 'current_ptd': '14.56', 'last_year_ptd': '19.09', 'current_ytd': '14.56', 'last_ytd': '19.09', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 6285)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:22,044 | ERROR | ‚ùå performance_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-04-2025 - 01 - 04- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '46.88 %', 'current_ptd': '46.07 %', 'last_year_ptd': '51.12 %', 'current_ytd': '46.07 %', 'last_ytd': '51.12 %', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'Occ% of Total Rooms', 'today': '27.03 %', 'current_ptd': '27.70 %', 'last_year_ptd': '30.86 %', 'current_ytd': '27.70 %', 'last_ytd': '30.86 %', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '22.52 %', 'current_ptd': '23.20 %', 'last_year_ptd': '30.86 %', 'current_ytd': '23.20 %', 'last_ytd': '30.86 %', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'ADR Stay Over Rooms', 'today': '55.05', 'current_ptd': '60.43', 'last_year_ptd': '64.19', 'current_ytd': '60.43', 'last_ytd': '64.19', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '55.05', 'current_ptd': '60.43', 'last_year_ptd': '64.19', 'current_ytd': '60.43', 'last_ytd': '64.19', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '55.05', 'current_ptd': '60.43', 'last_year_ptd': '64.19', 'current_ytd': '60.43', 'last_ytd': '64.19', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '45.88', 'current_ptd': '50.60', 'last_year_ptd': '64.19', 'current_ytd': '50.60', 'last_ytd': '64.19', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'RevPar', 'today': '21.51', 'current_ptd': '23.31', 'last_year_ptd': '32.81', 'current_ytd': '23.31', 'last_ytd': '32.81', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'STR (STAR) RevPar', 'today': '12.40', 'current_ptd': '14.02', 'last_year_ptd': '19.81', 'current_ytd': '14.02', 'last_ytd': '19.81', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-04-2025 - 01 - 04- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-04-2025 - 01 - 04- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '46.88 %', 'current_ptd': '46.07 %', 'last_year_ptd': '51.12 %', 'current_ytd': '46.07 %', 'last_ytd': '51.12 %', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'Occ% of Total Rooms', 'today': '27.03 %', 'current_ptd': '27.70 %', 'last_year_ptd': '30.86 %', 'current_ytd': '27.70 %', 'last_ytd': '30.86 %', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '22.52 %', 'current_ptd': '23.20 %', 'last_year_ptd': '30.86 %', 'current_ytd': '23.20 %', 'last_ytd': '30.86 %', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'ADR Stay Over Rooms', 'today': '55.05', 'current_ptd': '60.43', 'last_year_ptd': '64.19', 'current_ytd': '60.43', 'last_ytd': '64.19', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '55.05', 'current_ptd': '60.43', 'last_year_ptd': '64.19', 'current_ytd': '60.43', 'last_ytd': '64.19', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '55.05', 'current_ptd': '60.43', 'last_year_ptd': '64.19', 'current_ytd': '60.43', 'last_ytd': '64.19', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '45.88', 'current_ptd': '50.60', 'last_year_ptd': '64.19', 'current_ytd': '50.60', 'last_ytd': '64.19', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'RevPar', 'today': '21.51', 'current_ptd': '23.31', 'last_year_ptd': '32.81', 'current_ytd': '23.31', 'last_ytd': '32.81', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)}, {'metric': 'STR (STAR) RevPar', 'today': '12.40', 'current_ptd': '14.02', 'last_year_ptd': '19.81', 'current_ytd': '14.02', 'last_ytd': '19.81', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 24723)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:22,194 | ERROR | ‚ùå performance_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-07-2025 - 01 - 07- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '50.00 %', 'current_ptd': '47.49 %', 'last_year_ptd': '49.28 %', 'current_ytd': '47.49 %', 'last_ytd': '49.28 %', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'Occ% of Total Rooms', 'today': '28.83 %', 'current_ptd': '28.06 %', 'last_year_ptd': '30.89 %', 'current_ytd': '28.06 %', 'last_ytd': '30.89 %', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '24.32 %', 'current_ptd': '23.55 %', 'last_year_ptd': '30.89 %', 'current_ytd': '23.55 %', 'last_ytd': '30.89 %', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'ADR Stay Over Rooms', 'today': '62.95', 'current_ptd': '61.35', 'last_year_ptd': '63.66', 'current_ytd': '61.35', 'last_ytd': '63.66', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '62.95', 'current_ptd': '61.35', 'last_year_ptd': '63.66', 'current_ytd': '61.35', 'last_ytd': '63.66', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '62.95', 'current_ptd': '61.35', 'last_year_ptd': '63.66', 'current_ytd': '61.35', 'last_ytd': '63.66', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '53.11', 'current_ptd': '51.50', 'last_year_ptd': '63.66', 'current_ytd': '51.50', 'last_ytd': '63.66', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'RevPar', 'today': '26.56', 'current_ptd': '24.46', 'last_year_ptd': '31.37', 'current_ytd': '24.46', 'last_ytd': '31.37', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'STR (STAR) RevPar', 'today': '15.31', 'current_ptd': '14.45', 'last_year_ptd': '19.66', 'current_ytd': '14.45', 'last_ytd': '19.66', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-07-2025 - 01 - 07- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-07-2025 - 01 - 07- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '50.00 %', 'current_ptd': '47.49 %', 'last_year_ptd': '49.28 %', 'current_ytd': '47.49 %', 'last_ytd': '49.28 %', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'Occ% of Total Rooms', 'today': '28.83 %', 'current_ptd': '28.06 %', 'last_year_ptd': '30.89 %', 'current_ytd': '28.06 %', 'last_ytd': '30.89 %', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '24.32 %', 'current_ptd': '23.55 %', 'last_year_ptd': '30.89 %', 'current_ytd': '23.55 %', 'last_ytd': '30.89 %', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'ADR Stay Over Rooms', 'today': '62.95', 'current_ptd': '61.35', 'last_year_ptd': '63.66', 'current_ytd': '61.35', 'last_ytd': '63.66', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '62.95', 'current_ptd': '61.35', 'last_year_ptd': '63.66', 'current_ytd': '61.35', 'last_ytd': '63.66', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '62.95', 'current_ptd': '61.35', 'last_year_ptd': '63.66', 'current_ytd': '61.35', 'last_ytd': '63.66', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '53.11', 'current_ptd': '51.50', 'last_year_ptd': '63.66', 'current_ytd': '51.50', 'last_ytd': '63.66', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'RevPar', 'today': '26.56', 'current_ptd': '24.46', 'last_year_ptd': '31.37', 'current_ytd': '24.46', 'last_ytd': '31.37', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)}, {'metric': 'STR (STAR) RevPar', 'today': '15.31', 'current_ptd': '14.45', 'last_year_ptd': '19.66', 'current_ytd': '14.45', 'last_ytd': '19.66', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 168299)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:22,409 | ERROR | ‚ùå performance_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-08-2025 - 01 - 08- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '50.79 %', 'current_ptd': '47.89 %', 'last_year_ptd': '48.93 %', 'current_ytd': '47.89 %', 'last_ytd': '48.93 %', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'Occ% of Total Rooms', 'today': '28.83 %', 'current_ptd': '28.15 %', 'last_year_ptd': '30.86 %', 'current_ytd': '28.15 %', 'last_ytd': '30.86 %', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '24.32 %', 'current_ptd': '23.65 %', 'last_year_ptd': '30.86 %', 'current_ytd': '23.65 %', 'last_ytd': '30.86 %', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'ADR Stay Over Rooms', 'today': '64.05', 'current_ptd': '61.70', 'last_year_ptd': '63.55', 'current_ytd': '61.70', 'last_ytd': '63.55', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '64.05', 'current_ptd': '61.70', 'last_year_ptd': '63.55', 'current_ytd': '61.70', 'last_ytd': '63.55', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '64.05', 'current_ptd': '61.70', 'last_year_ptd': '63.55', 'current_ytd': '61.70', 'last_ytd': '63.55', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '54.04', 'current_ptd': '51.83', 'last_year_ptd': '63.55', 'current_ytd': '51.83', 'last_ytd': '63.55', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'RevPar', 'today': '27.45', 'current_ptd': '24.82', 'last_year_ptd': '31.09', 'current_ytd': '24.82', 'last_ytd': '31.09', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'STR (STAR) RevPar', 'today': '15.58', 'current_ptd': '14.59', 'last_year_ptd': '19.61', 'current_ytd': '14.59', 'last_ytd': '19.61', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-08-2025 - 01 - 08- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-08-2025 - 01 - 08- Night Audit Packet.pdf-Occ% of Total ' for key 'performance_statistics.PRIMARY'
[SQL: INSERT INTO performance_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Occ% of Total Available Rooms', 'today': '50.79 %', 'current_ptd': '47.89 %', 'last_year_ptd': '48.93 %', 'current_ytd': '47.89 %', 'last_ytd': '48.93 %', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'Occ% of Total Rooms', 'today': '28.83 %', 'current_ptd': '28.15 %', 'last_year_ptd': '30.86 %', 'current_ytd': '28.15 %', 'last_ytd': '30.86 %', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'STR (STAR) Occ% of Total Rooms', 'today': '24.32 %', 'current_ptd': '23.65 %', 'last_year_ptd': '30.86 %', 'current_ytd': '23.65 %', 'last_ytd': '30.86 %', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'ADR Stay Over Rooms', 'today': '64.05', 'current_ptd': '61.70', 'last_year_ptd': '63.55', 'current_ytd': '61.70', 'last_ytd': '63.55', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'ADR for Total Rev Rooms.', 'today': '64.05', 'current_ptd': '61.70', 'last_year_ptd': '63.55', 'current_ytd': '61.70', 'last_ytd': '63.55', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'STR (STAR) ADR for Total Rev Rooms.', 'today': '64.05', 'current_ptd': '61.70', 'last_year_ptd': '63.55', 'current_ytd': '61.70', 'last_ytd': '63.55', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'ADR for Total Occupied Rooms', 'today': '54.04', 'current_ptd': '51.83', 'last_year_ptd': '63.55', 'current_ytd': '51.83', 'last_ytd': '63.55', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'RevPar', 'today': '27.45', 'current_ptd': '24.82', 'last_year_ptd': '31.09', 'current_ytd': '24.82', 'last_ytd': '31.09', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)}, {'metric': 'STR (STAR) RevPar', 'today': '15.58', 'current_ptd': '14.59', 'last_year_ptd': '19.61', 'current_ytd': '14.59', 'last_ytd': '19.61', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 22, 380688)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:30,412 | ERROR | ‚ùå guest_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-01-2025 - 01 - 01- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '52', 'current_ptd': '52', 'last_year_ptd': '52', 'current_ytd': '52', 'last_ytd': '52', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 394535)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '2', 'last_year_ptd': '2', 'current_ytd': '2', 'last_ytd': '2', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 394535)}, {'metric': 'Total Number of Guests', 'today': '54', 'current_ptd': '54', 'last_year_ptd': '54', 'current_ytd': '54', 'last_ytd': '54', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 394535)}, {'metric': 'Average Adults Per Room', 'today': '1.68', 'current_ptd': '1.68', 'last_year_ptd': '1.79', 'current_ytd': '1.68', 'last_ytd': '1.79', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 394535)}, {'metric': 'Average Rate Per Adult', 'today': '30.38', 'current_ptd': '30.38', 'last_year_ptd': '35.70', 'current_ytd': '30.38', 'last_ytd': '35.70', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 394535)}, {'metric': 'Average Revenue Per Adult', 'today': '30.38', 'current_ptd': '30.38', 'last_year_ptd': '36.18', 'current_ytd': '30.38', 'last_ytd': '36.18', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 394535)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-01-2025 - 01 - 01- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-01-2025 - 01 - 01- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '52', 'current_ptd': '52', 'last_year_ptd': '52', 'current_ytd': '52', 'last_ytd': '52', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 394535)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '2', 'last_year_ptd': '2', 'current_ytd': '2', 'last_ytd': '2', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 394535)}, {'metric': 'Total Number of Guests', 'today': '54', 'current_ptd': '54', 'last_year_ptd': '54', 'current_ytd': '54', 'last_ytd': '54', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 394535)}, {'metric': 'Average Adults Per Room', 'today': '1.68', 'current_ptd': '1.68', 'last_year_ptd': '1.79', 'current_ytd': '1.68', 'last_ytd': '1.79', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 394535)}, {'metric': 'Average Rate Per Adult', 'today': '30.38', 'current_ptd': '30.38', 'last_year_ptd': '35.70', 'current_ytd': '30.38', 'last_ytd': '35.70', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 394535)}, {'metric': 'Average Revenue Per Adult', 'today': '30.38', 'current_ptd': '30.38', 'last_year_ptd': '36.18', 'current_ytd': '30.38', 'last_ytd': '36.18', 'business_date': datetime.date(2025, 1, 1), 'source_file': '2025 - 01 - 01- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 394535)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:30,437 | INFO | ‚úÖ Processed Ledger Activity
2025-05-10 23:04:30,938 | ERROR | ‚ùå guest_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-02-2025 - 01 - 02- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '52', 'current_ptd': '104', 'last_year_ptd': '108', 'current_ytd': '104', 'last_ytd': '108', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 912783)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '4', 'last_year_ptd': '4', 'current_ytd': '4', 'last_ytd': '4', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 912783)}, {'metric': 'Total Number of Guests', 'today': '54', 'current_ptd': '108', 'last_year_ptd': '112', 'current_ytd': '108', 'last_ytd': '112', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 912783)}, {'metric': 'Average Adults Per Room', 'today': '1.68', 'current_ptd': '1.68', 'last_year_ptd': '1.74', 'current_ytd': '1.68', 'last_ytd': '1.74', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 912783)}, {'metric': 'Average Rate Per Adult', 'today': '30.99', 'current_ptd': '30.68', 'last_year_ptd': '36.88', 'current_ytd': '30.68', 'last_ytd': '36.88', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 912783)}, {'metric': 'Average Revenue Per Adult', 'today': '30.99', 'current_ptd': '30.68', 'last_year_ptd': '37.33', 'current_ytd': '30.68', 'last_ytd': '37.33', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 912783)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-02-2025 - 01 - 02- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-02-2025 - 01 - 02- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '52', 'current_ptd': '104', 'last_year_ptd': '108', 'current_ytd': '104', 'last_ytd': '108', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 912783)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '4', 'last_year_ptd': '4', 'current_ytd': '4', 'last_ytd': '4', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 912783)}, {'metric': 'Total Number of Guests', 'today': '54', 'current_ptd': '108', 'last_year_ptd': '112', 'current_ytd': '108', 'last_ytd': '112', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 912783)}, {'metric': 'Average Adults Per Room', 'today': '1.68', 'current_ptd': '1.68', 'last_year_ptd': '1.74', 'current_ytd': '1.68', 'last_ytd': '1.74', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 912783)}, {'metric': 'Average Rate Per Adult', 'today': '30.99', 'current_ptd': '30.68', 'last_year_ptd': '36.88', 'current_ytd': '30.68', 'last_ytd': '36.88', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 912783)}, {'metric': 'Average Revenue Per Adult', 'today': '30.99', 'current_ptd': '30.68', 'last_year_ptd': '37.33', 'current_ytd': '30.68', 'last_ytd': '37.33', 'business_date': datetime.date(2025, 1, 2), 'source_file': '2025 - 01 - 02- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 30, 912783)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:30,981 | INFO | ‚úÖ Processed Ledger Activity
2025-05-10 23:04:31,498 | ERROR | ‚ùå guest_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-06-2025 - 01 - 06- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '58', 'current_ptd': '317', 'last_year_ptd': '350', 'current_ytd': '317', 'last_ytd': '350', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 463362)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '12', 'last_year_ptd': '12', 'current_ytd': '12', 'last_ytd': '12', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 463362)}, {'metric': 'Total Number of Guests', 'today': '60', 'current_ptd': '329', 'last_year_ptd': '362', 'current_ytd': '329', 'last_ytd': '362', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 463362)}, {'metric': 'Average Adults Per Room', 'today': '1.81', 'current_ptd': '1.70', 'last_year_ptd': '1.66', 'current_ytd': '1.70', 'last_ytd': '1.66', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 463362)}, {'metric': 'Average Rate Per Adult', 'today': '28.83', 'current_ptd': '30.06', 'last_year_ptd': '38.55', 'current_ytd': '30.06', 'last_ytd': '38.55', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 463362)}, {'metric': 'Average Revenue Per Adult', 'today': '28.83', 'current_ptd': '30.06', 'last_year_ptd': '38.86', 'current_ytd': '30.06', 'last_ytd': '38.86', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 463362)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-06-2025 - 01 - 06- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-06-2025 - 01 - 06- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '58', 'current_ptd': '317', 'last_year_ptd': '350', 'current_ytd': '317', 'last_ytd': '350', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 463362)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '12', 'last_year_ptd': '12', 'current_ytd': '12', 'last_ytd': '12', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 463362)}, {'metric': 'Total Number of Guests', 'today': '60', 'current_ptd': '329', 'last_year_ptd': '362', 'current_ytd': '329', 'last_ytd': '362', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 463362)}, {'metric': 'Average Adults Per Room', 'today': '1.81', 'current_ptd': '1.70', 'last_year_ptd': '1.66', 'current_ytd': '1.70', 'last_ytd': '1.66', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 463362)}, {'metric': 'Average Rate Per Adult', 'today': '28.83', 'current_ptd': '30.06', 'last_year_ptd': '38.55', 'current_ytd': '30.06', 'last_ytd': '38.55', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 463362)}, {'metric': 'Average Revenue Per Adult', 'today': '28.83', 'current_ptd': '30.06', 'last_year_ptd': '38.86', 'current_ytd': '30.06', 'last_ytd': '38.86', 'business_date': datetime.date(2025, 1, 6), 'source_file': '2025 - 01 - 06- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 463362)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:31,531 | INFO | ‚úÖ Processed Ledger Activity
2025-05-10 23:04:31,889 | ERROR | ‚ùå guest_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-05-2025 - 01 - 05- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '54', 'current_ptd': '259', 'last_year_ptd': '293', 'current_ytd': '259', 'last_ytd': '293', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 848922)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '10', 'last_year_ptd': '10', 'current_ytd': '10', 'last_ytd': '10', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 848922)}, {'metric': 'Total Number of Guests', 'today': '56', 'current_ptd': '269', 'last_year_ptd': '303', 'current_ytd': '269', 'last_ytd': '303', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 848922)}, {'metric': 'Average Adults Per Room', 'today': '1.74', 'current_ptd': '1.68', 'last_year_ptd': '1.66', 'current_ytd': '1.68', 'last_ytd': '1.66', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 848922)}, {'metric': 'Average Rate Per Adult', 'today': '30.21', 'current_ptd': '30.33', 'last_year_ptd': '38.78', 'current_ytd': '30.33', 'last_ytd': '38.78', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 848922)}, {'metric': 'Average Revenue Per Adult', 'today': '30.21', 'current_ptd': '30.33', 'last_year_ptd': '39.12', 'current_ytd': '30.33', 'last_ytd': '39.12', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 848922)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-05-2025 - 01 - 05- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-05-2025 - 01 - 05- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '54', 'current_ptd': '259', 'last_year_ptd': '293', 'current_ytd': '259', 'last_ytd': '293', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 848922)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '10', 'last_year_ptd': '10', 'current_ytd': '10', 'last_ytd': '10', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 848922)}, {'metric': 'Total Number of Guests', 'today': '56', 'current_ptd': '269', 'last_year_ptd': '303', 'current_ytd': '269', 'last_ytd': '303', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 848922)}, {'metric': 'Average Adults Per Room', 'today': '1.74', 'current_ptd': '1.68', 'last_year_ptd': '1.66', 'current_ytd': '1.68', 'last_ytd': '1.66', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 848922)}, {'metric': 'Average Rate Per Adult', 'today': '30.21', 'current_ptd': '30.33', 'last_year_ptd': '38.78', 'current_ytd': '30.33', 'last_ytd': '38.78', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 848922)}, {'metric': 'Average Revenue Per Adult', 'today': '30.21', 'current_ptd': '30.33', 'last_year_ptd': '39.12', 'current_ytd': '30.33', 'last_ytd': '39.12', 'business_date': datetime.date(2025, 1, 5), 'source_file': '2025 - 01 - 05- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 31, 848922)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:31,911 | INFO | ‚úÖ Processed Ledger Activity
2025-05-10 23:04:32,120 | ERROR | ‚ùå guest_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-03-2025 - 01 - 03- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '50', 'current_ptd': '154', 'last_year_ptd': '168', 'current_ytd': '154', 'last_ytd': '168', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 93523)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '6', 'last_year_ptd': '6', 'current_ytd': '6', 'last_ytd': '6', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 93523)}, {'metric': 'Total Number of Guests', 'today': '52', 'current_ptd': '160', 'last_year_ptd': '174', 'current_ytd': '160', 'last_ytd': '174', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 93523)}, {'metric': 'Average Adults Per Room', 'today': '1.61', 'current_ptd': '1.66', 'last_year_ptd': '1.70', 'current_ytd': '1.66', 'last_ytd': '1.70', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 93523)}, {'metric': 'Average Rate Per Adult', 'today': '33.13', 'current_ptd': '31.48', 'last_year_ptd': '37.84', 'current_ytd': '31.48', 'last_ytd': '37.84', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 93523)}, {'metric': 'Average Revenue Per Adult', 'today': '33.13', 'current_ptd': '31.48', 'last_year_ptd': '38.28', 'current_ytd': '31.48', 'last_ytd': '38.28', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 93523)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-03-2025 - 01 - 03- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-03-2025 - 01 - 03- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '50', 'current_ptd': '154', 'last_year_ptd': '168', 'current_ytd': '154', 'last_ytd': '168', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 93523)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '6', 'last_year_ptd': '6', 'current_ytd': '6', 'last_ytd': '6', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 93523)}, {'metric': 'Total Number of Guests', 'today': '52', 'current_ptd': '160', 'last_year_ptd': '174', 'current_ytd': '160', 'last_ytd': '174', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 93523)}, {'metric': 'Average Adults Per Room', 'today': '1.61', 'current_ptd': '1.66', 'last_year_ptd': '1.70', 'current_ytd': '1.66', 'last_ytd': '1.70', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 93523)}, {'metric': 'Average Rate Per Adult', 'today': '33.13', 'current_ptd': '31.48', 'last_year_ptd': '37.84', 'current_ytd': '31.48', 'last_ytd': '37.84', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 93523)}, {'metric': 'Average Revenue Per Adult', 'today': '33.13', 'current_ptd': '31.48', 'last_year_ptd': '38.28', 'current_ytd': '31.48', 'last_ytd': '38.28', 'business_date': datetime.date(2025, 1, 3), 'source_file': '2025 - 01 - 03- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 93523)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:32,145 | INFO | ‚úÖ Processed Ledger Activity
2025-05-10 23:04:32,146 | ERROR | ‚ùå guest_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-04-2025 - 01 - 04- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '51', 'current_ptd': '205', 'last_year_ptd': '230', 'current_ytd': '205', 'last_ytd': '230', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 105752)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '8', 'last_year_ptd': '8', 'current_ytd': '8', 'last_ytd': '8', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 105752)}, {'metric': 'Total Number of Guests', 'today': '53', 'current_ptd': '213', 'last_year_ptd': '238', 'current_ytd': '213', 'last_ytd': '238', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 105752)}, {'metric': 'Average Adults Per Room', 'today': '1.70', 'current_ptd': '1.67', 'last_year_ptd': '1.68', 'current_ytd': '1.67', 'last_ytd': '1.68', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 105752)}, {'metric': 'Average Rate Per Adult', 'today': '26.99', 'current_ptd': '30.36', 'last_year_ptd': '38.24', 'current_ytd': '30.36', 'last_ytd': '38.24', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 105752)}, {'metric': 'Average Revenue Per Adult', 'today': '26.99', 'current_ptd': '30.36', 'last_year_ptd': '38.64', 'current_ytd': '30.36', 'last_ytd': '38.64', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 105752)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-04-2025 - 01 - 04- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-04-2025 - 01 - 04- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '51', 'current_ptd': '205', 'last_year_ptd': '230', 'current_ytd': '205', 'last_ytd': '230', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 105752)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '8', 'last_year_ptd': '8', 'current_ytd': '8', 'last_ytd': '8', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 105752)}, {'metric': 'Total Number of Guests', 'today': '53', 'current_ptd': '213', 'last_year_ptd': '238', 'current_ytd': '213', 'last_ytd': '238', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 105752)}, {'metric': 'Average Adults Per Room', 'today': '1.70', 'current_ptd': '1.67', 'last_year_ptd': '1.68', 'current_ytd': '1.67', 'last_ytd': '1.68', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 105752)}, {'metric': 'Average Rate Per Adult', 'today': '26.99', 'current_ptd': '30.36', 'last_year_ptd': '38.24', 'current_ytd': '30.36', 'last_ytd': '38.24', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 105752)}, {'metric': 'Average Revenue Per Adult', 'today': '26.99', 'current_ptd': '30.36', 'last_year_ptd': '38.64', 'current_ytd': '30.36', 'last_ytd': '38.64', 'business_date': datetime.date(2025, 1, 4), 'source_file': '2025 - 01 - 04- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 105752)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:32,227 | INFO | ‚úÖ Processed Ledger Activity
2025-05-10 23:04:32,303 | ERROR | ‚ùå guest_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-07-2025 - 01 - 07- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '56', 'current_ptd': '373', 'last_year_ptd': '401', 'current_ytd': '373', 'last_ytd': '401', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 254171)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '14', 'last_year_ptd': '14', 'current_ytd': '14', 'last_ytd': '14', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 254171)}, {'metric': 'Total Number of Guests', 'today': '58', 'current_ptd': '387', 'last_year_ptd': '415', 'current_ytd': '387', 'last_ytd': '415', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 254171)}, {'metric': 'Average Adults Per Room', 'today': '1.75', 'current_ptd': '1.71', 'last_year_ptd': '1.67', 'current_ytd': '1.71', 'last_ytd': '1.67', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 254171)}, {'metric': 'Average Rate Per Adult', 'today': '30.35', 'current_ptd': '30.10', 'last_year_ptd': '38.10', 'current_ytd': '30.10', 'last_ytd': '38.10', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 254171)}, {'metric': 'Average Revenue Per Adult', 'today': '30.35', 'current_ptd': '30.10', 'last_year_ptd': '38.38', 'current_ytd': '30.10', 'last_ytd': '38.38', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 254171)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-07-2025 - 01 - 07- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-07-2025 - 01 - 07- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '56', 'current_ptd': '373', 'last_year_ptd': '401', 'current_ytd': '373', 'last_ytd': '401', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 254171)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '14', 'last_year_ptd': '14', 'current_ytd': '14', 'last_ytd': '14', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 254171)}, {'metric': 'Total Number of Guests', 'today': '58', 'current_ptd': '387', 'last_year_ptd': '415', 'current_ytd': '387', 'last_ytd': '415', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 254171)}, {'metric': 'Average Adults Per Room', 'today': '1.75', 'current_ptd': '1.71', 'last_year_ptd': '1.67', 'current_ytd': '1.71', 'last_ytd': '1.67', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 254171)}, {'metric': 'Average Rate Per Adult', 'today': '30.35', 'current_ptd': '30.10', 'last_year_ptd': '38.10', 'current_ytd': '30.10', 'last_ytd': '38.10', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 254171)}, {'metric': 'Average Revenue Per Adult', 'today': '30.35', 'current_ptd': '30.10', 'last_year_ptd': '38.38', 'current_ytd': '30.10', 'last_ytd': '38.38', 'business_date': datetime.date(2025, 1, 7), 'source_file': '2025 - 01 - 07- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 254171)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:32,323 | INFO | ‚úÖ Processed Ledger Activity
2025-05-10 23:04:32,537 | ERROR | ‚ùå guest_statistics extraction failed: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-08-2025 - 01 - 08- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '57', 'current_ptd': '430', 'last_year_ptd': '455', 'current_ytd': '430', 'last_ytd': '455', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 477608)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '16', 'last_year_ptd': '16', 'current_ytd': '16', 'last_ytd': '16', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 477608)}, {'metric': 'Total Number of Guests', 'today': '59', 'current_ptd': '446', 'last_year_ptd': '471', 'current_ytd': '446', 'last_ytd': '471', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 477608)}, {'metric': 'Average Adults Per Room', 'today': '1.78', 'current_ptd': '1.72', 'last_year_ptd': '1.66', 'current_ytd': '1.72', 'last_ytd': '1.66', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 477608)}, {'metric': 'Average Rate Per Adult', 'today': '30.34', 'current_ptd': '30.13', 'last_year_ptd': '38.27', 'current_ytd': '30.13', 'last_ytd': '38.27', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 477608)}, {'metric': 'Average Revenue Per Adult', 'today': '30.34', 'current_ptd': '30.13', 'last_year_ptd': '38.53', 'current_ytd': '30.13', 'last_ytd': '38.53', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 477608)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry '2025-01-08-2025 - 01 - 08- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/processor.py", line 78, in handle_section
    insert_dataframe(engine, df, table_name, filename)
  File "/Users/sandeepmalkanoor/Documents/Python/Night_Audit_DataEngineering_Project/night_audit_etl_pipeline/db_utils.py", line 45, in insert_dataframe
    df.to_sql(table_name, con=engine, if_exists='append', index=False)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/opt/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1306, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 332, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1498, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1862, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2043, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1799, in _execute_context
    self.dialect.do_executemany(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 729, in do_executemany
    cursor.executemany(statement, parameters)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 643, in executemany
    return self.execute(stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/cursor.py", line 537, in execute
    self._handle_result(self._connection.cmd_query(stmt))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/opentelemetry/context_propagation.py", line 97, in wrapper
    return method(cnx, *args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 872, in cmd_query
    result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
  File "/opt/anaconda3/lib/python3.9/site-packages/mysql/connector/connection.py", line 648, in _handle_result
    raise get_exception(packet)
sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry '2025-01-08-2025 - 01 - 08- Night Audit Packet.pdf-Number of Adul' for key 'guest_statistics.PRIMARY'
[SQL: INSERT INTO guest_statistics (metric, today, current_ptd, last_year_ptd, current_ytd, last_ytd, business_date, source_file, load_timestamp) VALUES (%(metric)s, %(today)s, %(current_ptd)s, %(last_year_ptd)s, %(current_ytd)s, %(last_ytd)s, %(business_date)s, %(source_file)s, %(load_timestamp)s)]
[parameters: ({'metric': 'Number of Adults', 'today': '57', 'current_ptd': '430', 'last_year_ptd': '455', 'current_ytd': '430', 'last_ytd': '455', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 477608)}, {'metric': 'Number of Children', 'today': '2', 'current_ptd': '16', 'last_year_ptd': '16', 'current_ytd': '16', 'last_ytd': '16', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 477608)}, {'metric': 'Total Number of Guests', 'today': '59', 'current_ptd': '446', 'last_year_ptd': '471', 'current_ytd': '446', 'last_ytd': '471', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 477608)}, {'metric': 'Average Adults Per Room', 'today': '1.78', 'current_ptd': '1.72', 'last_year_ptd': '1.66', 'current_ytd': '1.72', 'last_ytd': '1.66', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 477608)}, {'metric': 'Average Rate Per Adult', 'today': '30.34', 'current_ptd': '30.13', 'last_year_ptd': '38.27', 'current_ytd': '30.13', 'last_ytd': '38.27', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 477608)}, {'metric': 'Average Revenue Per Adult', 'today': '30.34', 'current_ptd': '30.13', 'last_year_ptd': '38.53', 'current_ytd': '30.13', 'last_ytd': '38.53', 'business_date': datetime.date(2025, 1, 8), 'source_file': '2025 - 01 - 08- Night Audit Packet.pdf', 'load_timestamp': datetime.datetime(2025, 5, 10, 23, 4, 32, 477608)})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

2025-05-10 23:04:32,604 | INFO | ‚úÖ Processed Ledger Activity
2025-05-10 23:04:35,786 | INFO | ‚úÖ Processed Ledger Summary
2025-05-10 23:04:35,791 | WARNING | ‚ö†Ô∏è No No Show Report data in 2025 - 01 - 01- Night Audit Packet.pdf
2025-05-10 23:04:35,819 | INFO | ‚úÖ Processed Rate Discrepancy
2025-05-10 23:04:35,862 | INFO | ‚úÖ Processed Hotel Journal Summary
2025-05-10 23:04:35,900 | INFO | ‚úÖ Processed Hotel Journal Detail
2025-05-10 23:04:35,924 | INFO | ‚úÖ Processed Reservation Activity ‚Üí reservation_activity (7 rows)
2025-05-10 23:04:35,939 | INFO | ‚úÖ Processed Shift Reconciliation ‚Üí shift_reconciliation (1 rows)
2025-05-10 23:04:35,955 | INFO | ‚úÖ Processed Shift Reconciliation ‚Üí shift_summary (3 rows)
2025-05-10 23:04:35,978 | INFO | ‚úÖ Processed Tax Exempt ‚Üí exempt_revenue_tax (2 rows)
2025-05-10 23:04:35,978 | WARNING | ‚ö†Ô∏è No Tax Exempt data for exempt_tax in 2025 - 01 - 01- Night Audit Packet.pdf
2025-05-10 23:04:35,978 | WARNING | ‚ö†Ô∏è No Tax Exempt data for tax_exempt_revenue_summary in 2025 - 01 - 01- Night Audit Packet.pdf
2025-05-10 23:04:35,993 | INFO | ‚úÖ Processed Tax Exempt ‚Üí tax_refund_revenue_summary (2 rows)
2025-05-10 23:04:36,023 | INFO | ‚úÖ Processed Gross Room Revenue ‚Üí gross_room_revenue_detail (3 rows)
2025-05-10 23:04:36,063 | INFO | ‚úÖ Processed Revenue by Rate Code ‚Üí revenue_by_rate_code (9 rows)
2025-05-10 23:04:36,082 | INFO | ‚úÖ Processed Advance Deposit Journal ‚Üí advance_deposit_journal (1 rows)
2025-05-10 23:04:36,093 | INFO | üìÑ Starting processing file: 2025 - 01 - 09- Night Audit Packet.pdf
